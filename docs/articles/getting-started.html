<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started with rbabylon • rbabylon</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with rbabylon">
<meta property="og:description" content="">
<meta property="og:image" content="https://metrumresearchgroup.github.io/rbabylon/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rbabylon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started.html">Getting Started with rbabylon</a>
    </li>
    <li>
      <a href="../articles/parameter-labels.html">rbabylon Parameter Labels</a>
    </li>
    <li>
      <a href="../articles/using-based-on.html">Using the based_on field</a>
    </li>
    <li>
      <a href="../articles/using-summary-log.html">Creating a Model Summary Log</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/metrumresearchgroup/rbabylon">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Getting Started with rbabylon</h1>
                        <h4 class="author">Seth Green</h4>
            
      
      
      <div class="hidden name"><code>getting-started.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This “Getting Started with rbabylon” vignette takes the user through some basic scenarios for modeling with NONMEM using <code>rbabylon</code>, introducing you to its standard workflow and functionality.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rbabylon)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(purrr)</a></code></pre></div>
<p><code>rbabylon</code> is an R interface for running <code>babylon</code>, which is (will be) a complete solution for managing projects involving modeling and simulation with a number of software solutions used in pharmaceutical sciences. Currently, only NONMEM is supported, so this vignette will only address that.</p>
</div>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<div id="installing-babylon" class="section level2">
<h2 class="hasAnchor">
<a href="#installing-babylon" class="anchor"></a>Installing babylon</h2>
<p>The <em>first time</em> you use <code>rbabylon</code> on a system or disk, you must first install <code>babylon</code>, often aliased as <code>bbi</code>. The <code>babylon</code> executable is a single binary file that can be easily installed with:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">rbabylon<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/rbabylon/man/use_bbi.html">use_bbi</a></span>(<span class="st">"/data/apps/"</span>)</a></code></pre></div>
<p>The <code><a href="../reference/use_bbi.html">use_bbi()</a></code> function takes the <em>directory</em> into which you want to install <code>bbi</code>. Note that this can be pointed to anywhere on your system; installing to <code>/data/apps/bbi</code> is merely a convention used at Metrum Research Group, where <code>rbabylon</code> was developed.</p>
<div id="setting-bbi_exe_path" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-bbi_exe_path" class="anchor"></a>Setting bbi_exe_path</h3>
<p>Once <code>bbi</code> is installed, you will need to make sure <code>rbabylon</code> knows where to find it. This can be done by setting the <code>rbabylon.bbi_exe_path</code> option like so:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="st">"rbabylon.bbi_exe_path"</span> =<span class="st"> "/data/apps/bbi"</span>)</a></code></pre></div>
<p>Please note that <strong>this must be set for every new R session, so it’s recommended to include the above snippet in your .Rprofile</strong>, replacing the <code>"/data/apps/bbi"</code> with the absolute path from your system/project, if you have installed it somewhere different.</p>
</div>
<div id="updating-bbi-or-checking-if-its-installed" class="section level3">
<h3 class="hasAnchor">
<a href="#updating-bbi-or-checking-if-its-installed" class="anchor"></a>Updating bbi or checking if it’s installed</h3>
<p>If you’re not sure if you have <code>babylon</code> installed, you can use <code><a href="../reference/bbi_version.html">bbi_version()</a></code> to check. This will return the version number of your installation, if one is found, or an empty string if you do <em>not</em> have <code>babylon</code> installed. You can also use <code><a href="../reference/bbi_current_release.html">bbi_current_release()</a></code> to see the most current version available and run <code><a href="../reference/use_bbi.html">use_bbi()</a></code> as specified above if you want to update.</p>
<p>You can also check the <a href="https://github.com/metrumresearchgroup/babylon">babylon documentation</a> for manual installation instructions from the command line.</p>
</div>
</div>
<div id="babylon-yaml-configuration-file" class="section level2">
<h2 class="hasAnchor">
<a href="#babylon-yaml-configuration-file" class="anchor"></a>babylon.yaml configuration file</h2>
<p>To actually submit models with <code>bbi</code>, you will also need a <code>babylon.yaml</code> configuration file. Think of this as containing “global default settings” for your <code>bbi</code> runs. Those settings will not be discussed here, but know that they can be modified globally by editing that file, or model-by-model as described in the “Passing arguments to bbi” section below.</p>
<div id="bbi_init" class="section level3">
<h3 class="hasAnchor">
<a href="#bbi_init" class="anchor"></a>bbi_init()</h3>
<p>The <code><a href="../reference/bbi_init.html">bbi_init()</a></code> function will create a <code>babylon.yaml</code>, with the default settings, in the specified directory. Optionally, you can pass the path to a <code>babylon.yaml</code> to the <code>.config_path</code> argument of any <code>rbabylon</code> function that needs one. However, by default these functions will look for one in the same folder as the model being submitted or manipulated. Therefore, if you will have a number of models in the same folder, it is easiest to put a <code>babylon.yaml</code> that folder.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">MODEL_DIR &lt;-<span class="st"> "../model/nonmem/basic"</span>  <span class="co"># this should be relative to your working directory</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw"><a href="../reference/bbi_init.html">bbi_init</a></span>(<span class="dt">.dir =</span> MODEL_DIR,            <span class="co"># the directory to create the babylon.yaml in</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">         <span class="dt">.nonmem_dir =</span> <span class="st">"/opt/NONMEM"</span>, <span class="co"># location of NONMEM installation</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">         <span class="dt">.nonmem_version =</span> <span class="st">"nm74gf"</span>)  <span class="co"># default NONMEM version to use</span></a></code></pre></div>
<p>Here we define a define variable <code>MODEL_DIR</code> with the path to the directory containing our models. Notice that you must also pass the path to a working installation of NONMEM, and a default NONMEM version to use.</p>
<p>Note <strong>this only needs to be done once</strong> for each folder you are modeling in. Once the <code>babylon.yaml</code> exists, you will <em>not</em> need to run <code><a href="../reference/bbi_init.html">bbi_init()</a></code> again unless you want to create another one; for example if you move to modeling in a different directory, or if you want a different set of default settings for some specific subset of models.</p>
</div>
</div>
</div>
<div id="initial-modeling-run" class="section level1">
<h1 class="hasAnchor">
<a href="#initial-modeling-run" class="anchor"></a>Initial modeling run</h1>
<div id="create-model-object" class="section level2">
<h2 class="hasAnchor">
<a href="#create-model-object" class="anchor"></a>Create model object</h2>
<p>To begin modeling, first create a model object using <code><a href="../reference/new_model.html">new_model()</a></code>. This is an S3 object which you will pass to all of the other <code>rbabylon</code> functions that submit, summarize, or manipulate models.</p>
<p>The first argument (<code>.path</code>) must be the path to your model control stream <em>without file extension</em>. For instance, the call below assumes you have a control stream named <code>1.ctl</code> or <code>1.mod</code> in the directory you just assigned to <code>MODEL_DIR</code> above.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">mod1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/new_model.html">new_model</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(MODEL_DIR, <span class="dv">1</span>))</a></code></pre></div>
<p>This <code><a href="../reference/new_model.html">new_model()</a></code> call will also create a <code>1.yaml</code> file in that same directory, which stores model metadata like description and tags (discussed below). If you ever need to recreate this model object in memory, just run <code>mod1 &lt;- read_model(file.path(MODEL_DIR, 1))</code> to rebuild it from the YAML file on disk.</p>
<p>The model object you have just created can be passed to various functions which you will see in a minute. Now that we’ve created a model, the first thing we will do is submit the model to be run.</p>
</div>
<div id="submit-model" class="section level2">
<h2 class="hasAnchor">
<a href="#submit-model" class="anchor"></a>Submit model</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">mod1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/submit_model.html">submit_model</a></span>()</a></code></pre></div>
<p>This will return a process object. We won’t discuss this object in this vignette, but it contains some information about the submission call. Please note that <strong>checking on a model run in progress is not fully implemented.</strong> For now, users should check on their runs manually (by looking at the output directory) and only proceed to the next steps once it has successfully completed.</p>
<div id="passing-arguments-to-bbi" class="section level3">
<h3 class="hasAnchor">
<a href="#passing-arguments-to-bbi" class="anchor"></a>Passing arguments to bbi</h3>
<p>There are a number of arguments that <code>bbi</code> can take to modify how models are run. You can print a list of available arguments using the <code><a href="../reference/print_bbi_args.html">print_bbi_args()</a></code> helper function.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/print_bbi_args.html">print_bbi_args</a></span>()</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; additional_post_work_envs (character) -- Any additional values (as ENV KEY=VALUE) to provide for the post execution environment (sets CLI flag `--additional_post_work_envs`)</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; background (logical) -- RAW NMFE OPTION - Tells nonmem not to scan StdIn for control characters (sets CLI flag `--background`)</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; clean_lvl (numeric) -- clean level used for file output from a given (set of) runs (default 1) (sets CLI flag `--clean_lvl`)</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; config (character) -- Path (relative or absolute) to another babylon.yaml to load (sets CLI flag `--config`)</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; copy_lvl (numeric) -- copy level used for file output from a given (set of) runs (sets CLI flag `--copy_lvl`)</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; debug (logical) -- debug mode (sets CLI flag `--debug`)</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt; delay (numeric) -- Selects a random number of seconds between 1 and this value to stagger / jitter job execution. Assists in dealing with large volumes of work dealing with the same data set. May avoid NMTRAN issues about not being able read / close files (sets CLI flag `--delay`)</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt; ext_file (character) -- name of custom ext-file (sets CLI flag `--ext-file`)</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt; git (logical) -- whether git is used (sets CLI flag `--git`)</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt; json (logical) -- json tree of output, if possible (sets CLI flag `--json`)</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt; licfile (character) -- RAW NMFE OPTION - Specify a license file to use with NMFE (Nonmem) (sets CLI flag `--licfile`)</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt; log_file (character) -- If populated, specifies the file into which to store the output / logging details from Babylon (sets CLI flag `--log_file`)</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; maxlim (numeric) -- RAW NMFE OPTION - Set the maximum values set for the buffers used by Nonmem (default 100) (sets CLI flag `--maxlim`)</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; mpi_exec_path (character) -- The fully qualified path to mpiexec. Used for nonmem parallel operations (default '/usr/local/mpich3/bin/mpiexec') (sets CLI flag `--mpi_exec_path`)</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt; nm_version (character) -- Version of nonmem from the configuration list to use (sets CLI flag `--nm_version`)</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt; nm_qual (logical) -- Whether or not to execute with nmqual (autolog.pl (sets CLI flag `--nmqual`)</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt; nobuild (logical) -- RAW NMFE OPTION - Skips recompiling and rebuilding on nonmem executable (sets CLI flag `--nobuild`)</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt; no_ext_file (logical) -- do not use ext file (sets CLI flag `--no-ext-file`)</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="co">#&gt; no_grd_file (logical) -- do not use grd file (sets CLI flag `--no-grd-file`)</span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="co">#&gt; no_shk_file (logical) -- do not use shk file (sets CLI flag `--no-shk-file`)</span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22"><span class="co">#&gt; overwrite (logical) -- Whether or not to remove existing output directories if they are present (sets CLI flag `--overwrite`)</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23"><span class="co">#&gt; parafile (character) -- Location of a user-provided parafile to use for parallel execution (sets CLI flag `--parafile`)</span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="co">#&gt; parallel (logical) -- Whether or not to run nonmem in parallel mode (sets CLI flag `--parallel`)</span></a>
<a class="sourceLine" id="cb7-25" data-line-number="25"><span class="co">#&gt; parallel_timeout (numeric) -- The amount of time to wait for parallel operations in nonmem before timing out (default 2147483647) (sets CLI flag `--parallel_timeout`)</span></a>
<a class="sourceLine" id="cb7-26" data-line-number="26"><span class="co">#&gt; post_work_executable (character) -- A script or binary to run when job execution completes or fails (sets CLI flag `--post_work_executable`)</span></a>
<a class="sourceLine" id="cb7-27" data-line-number="27"><span class="co">#&gt; prcompile (logical) -- RAW NMFE OPTION - Forces PREDPP compilation (sets CLI flag `--prcompile`)</span></a>
<a class="sourceLine" id="cb7-28" data-line-number="28"><span class="co">#&gt; prsame (logical) -- RAW NMFE OPTION - Indicates to nonmem that the PREDPP compilation step should be skipped (sets CLI flag `--prsame`)</span></a>
<a class="sourceLine" id="cb7-29" data-line-number="29"><span class="co">#&gt; preview (logical) -- preview action, but don't actually run command (sets CLI flag `--preview`)</span></a>
<a class="sourceLine" id="cb7-30" data-line-number="30"><span class="co">#&gt; save_config (logical) -- Whether or not to save the existing configuration to a file with the model (default true) (sets CLI flag `--save_config`)</span></a>
<a class="sourceLine" id="cb7-31" data-line-number="31"><span class="co">#&gt; threads (numeric) -- number of threads to execute with (default 4) (sets CLI flag `--threads`)</span></a>
<a class="sourceLine" id="cb7-32" data-line-number="32"><span class="co">#&gt; verbose (logical) -- verbose output (sets CLI flag `--verbose`)</span></a></code></pre></div>
<p>As discussed in “Setup” above, these can be set globally in the <code>babylon.yaml</code> file, and you can see the default values of them in that file. However, <strong>specific arguments can also be set or changed for each model.</strong> This can be done in two ways:</p>
<ul>
<li>Attaching them to a model object with <code><a href="../reference/modify_bbi_args.html">add_bbi_args()</a></code> or <code><a href="../reference/modify_bbi_args.html">replace_bbi_args()</a></code>
</li>
<li>Passing them as a named list to the <code>.bbi_args</code> argument of one of the following functions
<ul>
<li>
<code><a href="../reference/new_model.html">new_model()</a></code> or <code><a href="../reference/copy_model_from.html">copy_model_from()</a></code>
</li>
<li>
<code><a href="../reference/submit_model.html">submit_model()</a></code> or <code><a href="../reference/submit_models.html">submit_models()</a></code>
</li>
<li>
<code><a href="../reference/model_summary.html">model_summary()</a></code> or <code><a href="../reference/model_summaries.html">model_summaries()</a></code>
</li>
</ul>
</li>
</ul>
<p>Note that any <code>bbi_args</code> attached to a model object will override the relevant settings in <code>babylon.yaml</code>, and that <code>.bbi_args</code> passed into a <code>submit_</code> or <code>_summary</code> call will override the relevant settings in both <code>babylon.yaml</code> <em>and</em> <code>bbi_args</code> attached to the model object.</p>
<p>See the docs for any of the functions just mentioned for more details on usage and syntax.</p>
</div>
<div id="overwriting-output-from-a-previously-run-model" class="section level3">
<h3 class="hasAnchor">
<a href="#overwriting-output-from-a-previously-run-model" class="anchor"></a>Overwriting output from a previously run model</h3>
<p>It is common to run a model, make some tweaks to it, and then run it again. However, to avoid accidentally deleting model outputs, <code>rbabylon</code> will error by default if it sees existing output when trying to submit a model. To automatically overwrite any previous model output, just pass <code>overwrite = TRUE</code> to the <code>.bbi_args</code> argument described in the previous section. For example:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">mod1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/submit_model.html">submit_model</a></span>(<span class="dt">.bbi_args =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">overwrite =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<p>You can also change this setting globally by setting <code>overwrite: true</code> in the <code>babylon.yaml</code> file for your project.</p>
</div>
</div>
<div id="summarize-model" class="section level2">
<h2 class="hasAnchor">
<a href="#summarize-model" class="anchor"></a>Summarize model</h2>
<p>Once the model run has completed, users can get a summary object containing much of the commonly used diagnostic information in a named list.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">sum1 &lt;-<span class="st"> </span>mod1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/model_summary.html">model_summary</a></span>()</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(sum1))</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt; [1] "absolute_model_path" "run_details"         "run_heuristics"     </span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt; [4] "parameters_data"     "parameter_names"     "ofv"                </span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; [7] "condition_number"    "shrinkage_details"</span></a></code></pre></div>
<p>These elements can be accessed manually or extracted with built-in helper functions like so:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">param_df1 &lt;-<span class="st"> </span>sum1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/param_estimates.html">param_estimates</a></span>()</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">param_df1</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; # A tibble: 9 x 8</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt;   parameter_names estimate   stderr random_effect_sd random_effect_s… fixed</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt;   &lt;chr&gt;              &lt;dbl&gt;    &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt; &lt;lgl&gt;</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; 1 THETA1            2.31   8.61e- 2           NA              NA      FALSE</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; 2 THETA2           55.0    3.33e+ 0           NA              NA      FALSE</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; 3 THETA3          465.     2.96e+ 1           NA              NA      FALSE</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; 4 THETA4           -0.0806 5.55e- 2           NA              NA      FALSE</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; 5 THETA5            4.13   1.36e+ 0           NA              NA      FALSE</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; 6 OMEGA(1,1)        0.0964 2.00e- 2            0.311           0.0322 FALSE</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; 7 OMEGA(2,1)        0      1.00e+10            0     10000000000      TRUE </span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; 8 OMEGA(2,2)        0.154  2.67e- 2            0.392           0.0341 FALSE</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; 9 SIGMA(1,1)        1      1.00e+10            1     10000000000      TRUE </span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt; # … with 2 more variables: diag &lt;lgl&gt;, shrinkage &lt;dbl&gt;</span></a></code></pre></div>
<p>To see how to load summaries of multiple models to an easy-to-read tibble, see the <a href="https://metrumresearchgroup.github.io/rbabylon/articles/using-summary-log.html">Creating a Model Summary Log</a> vignette.</p>
</div>
</div>
<div id="iteration" class="section level1">
<h1 class="hasAnchor">
<a href="#iteration" class="anchor"></a>Iteration</h1>
<p>Much of the benefit of <code>rbabylon</code> is leveraged in the model iteration workflow, and the run log summaries that can be created afterwards. For example, imagine you look at these model results and want to begin iterating on them with a new model.</p>
<p>If you are now in a new R session and no longer have your <code>mod1</code> object in memory, you can easily rebuild it from the YAML file on disk with <code><a href="../reference/read_model.html">read_model()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">mod1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_model.html">read_model</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(MODEL_DIR, <span class="dv">1</span>))</a></code></pre></div>
<div id="copy_model_from" class="section level2">
<h2 class="hasAnchor">
<a href="#copy_model_from" class="anchor"></a>copy_model_from()</h2>
<p>Now you can create a new model object, based on the original, copying and renaming the control stream in the process. The <code><a href="../reference/copy_model_from.html">copy_model_from()</a></code> call below will create both <code>2.ctl</code> and <code>2.yaml</code> files in the same directory as the parent model, and return the model object corresponding to them. (<code><a href="../reference/copy_model_from.html">copy_model_from()</a></code> also stores the model’s “ancestry” which can be useful later in the project, as shown in the <a href="https://metrumresearchgroup.github.io/rbabylon/articles/using-based-on.html">Using the based_on field</a> vignette.)</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">mod2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/copy_model_from.html">copy_model_from</a></span>(mod1, <span class="dv">2</span>)</a></code></pre></div>
<p>Note that, while the <code>.path</code> argument in <code><a href="../reference/new_model.html">new_model()</a></code> and <code><a href="../reference/read_model.html">read_model()</a></code> is relative to your working directory, the <code>.new_model</code> argument of <code><a href="../reference/copy_model_from.html">copy_model_from()</a></code> is <em>relative to the directory containing the parent model.</em> This means that, assuming you would like to create the new model in the same directory as its parent, you only have to pass a filename (without extension) for the new model. Since, by convention, scientists often name their models numerically, you can also pass a number, which will be coerced to the relevant file names internally.</p>
<p>The new control stream file <code>2.ctl</code> can now be edited with the desired changes and then submitted and summarized exactly as above.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># manually edit control stream, then...</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">mod2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/submit_model.html">submit_model</a></span>()</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">mod2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/model_summary.html">model_summary</a></span>()</a></code></pre></div>
</div>
<div id="adding-tags-and-notes" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-tags-and-notes" class="anchor"></a>Adding tags and notes</h2>
<p>After looking at these results, the user can add tags, which can later be used to organize your modeling runs.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">mod1 &lt;-<span class="st"> </span>mod1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/modify_tags.html">add_tags</a></span>(<span class="st">"orig acop model"</span>)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">mod2 &lt;-<span class="st"> </span>mod2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/modify_tags.html">add_tags</a></span>(<span class="st">"2 compartment"</span>)</a></code></pre></div>
<p>Note that using free text for your tags is discouraged, for reasons mentioned in the <code><a href="../reference/modify_tags.html">?modify_tags</a></code> help page. For simplicity’s sake, we ignore that advice here, but please read it before using tags extensively in the wild.</p>
<p>In addition to tags, the user can add notes that can be referenced later.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">mod2 &lt;-<span class="st"> </span>mod2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/modify_notes.html">add_notes</a></span>(<span class="st">"2 compartment model more appropriate than 1 compartment"</span>)</a></code></pre></div>
</div>
<div id="continue-to-iterate" class="section level2">
<h2 class="hasAnchor">
<a href="#continue-to-iterate" class="anchor"></a>Continue to iterate…</h2>
<p>Now the iteration process continues with a third model. Note that you can tell <code><a href="../reference/copy_model_from.html">copy_model_from()</a></code> to inherit the tags from the parent model and automatically add them to the new model.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">mod3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/copy_model_from.html">copy_model_from</a></span>(mod2, <span class="dv">3</span>, <span class="dt">.inherit_tags =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Submit and summarize as before.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co"># manually edit control stream, then...</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">mod3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/submit_model.html">submit_model</a></span>()</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">mod3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/model_summary.html">model_summary</a></span>()</a></code></pre></div>
<p>Add tags and notes for filtering in run log, described next.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">mod3 &lt;-<span class="st"> </span>mod3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">        </span><span class="kw"><a href="../reference/modify_tags.html">add_tags</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"combined RUV"</span>, <span class="st">"iiv CL"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="st">        </span><span class="kw"><a href="../reference/modify_notes.html">add_notes</a></span>(<span class="st">"Added combined error structure because it seemed like a good idea"</span>)</a></code></pre></div>
</div>
</div>
<div id="run-log" class="section level1">
<h1 class="hasAnchor">
<a href="#run-log" class="anchor"></a>Run log</h1>
<p>At any point, the user can easily construct a “run log” tibble to summarize all models run up to this point.</p>
<p>Before we move on, note that you can get even more information about your models from the <code><a href="../reference/config_log.html">config_log()</a></code> and <code><a href="../reference/summary_log.html">summary_log()</a></code> functions, as well as <code><a href="../reference/config_log.html">add_config()</a></code> and <code><a href="../reference/summary_log.html">add_summary()</a></code> which automatically join the columns output from those functions against the tibble output from <code><a href="../reference/run_log.html">run_log()</a></code>. See the “Further Reading” section below for links to vignettes demonstrating those functions.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">log_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/run_log.html">run_log</a></span>(MODEL_DIR)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">log_df</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co">#&gt; # A tibble: 3 x 10</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co">#&gt;   absolute_model_… run   yaml_md5 model_type description bbi_args based_on tags </span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;       &lt;list&gt;   &lt;list&gt;   &lt;lis&gt;</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="co">#&gt; 1 /tmp/Rtmpxo18BY… 1     c7486e7… nonmem     &lt;NA&gt;        &lt;list [… &lt;NULL&gt;   &lt;chr…</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co">#&gt; 2 /tmp/Rtmpxo18BY… 2     bc60c6b… nonmem     &lt;NA&gt;        &lt;list [… &lt;chr [1… &lt;chr…</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="co">#&gt; 3 /tmp/Rtmpxo18BY… 3     cfceb67… nonmem     &lt;NA&gt;        &lt;list [… &lt;chr [1… &lt;chr…</span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co">#&gt; # … with 2 more variables: notes &lt;list&gt;, decisions &lt;list&gt;</span></a></code></pre></div>
<p>The <code><a href="../reference/run_log.html">run_log()</a></code> returns a tibble which can be manipulated like any other tibble. However, several of the columns (<code>tags</code>, <code>notes</code>, and <code>based_on</code> for example) are list columns, which complicates how you can interact with them. We provide some helper functions to more seamlessly interact with these log tibbles, as well as some sample <code>tidyverse</code> code below.</p>
<div id="viewing-tags-example" class="section level2">
<h2 class="hasAnchor">
<a href="#viewing-tags-example" class="anchor"></a>Viewing tags example</h2>
<p>The <code><a href="../reference/collapse_to_string.html">rbabylon::collapse_to_string()</a></code> function can collapse any list column into a string representation of its contents. It is specifically designed for collapsing columns like <code>tags</code>, <code>notes</code>, and <code>based_on</code> into a more human-readable format.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">log_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/collapse_to_string.html">collapse_to_string</a></span>(tags, notes) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(run, tags, notes)</a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co">#&gt; # A tibble: 3 x 3</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="co">#&gt;   run   tags                       notes                                        </span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                      &lt;chr&gt;                                        </span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="co">#&gt; 1 1     orig acop model            &lt;NA&gt;                                         </span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="co">#&gt; 2 2     2 compartment              2 compartment model more appropriate than 1 …</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="co">#&gt; 3 3     2 compartment, combined R… Added combined error structure because it se…</span></a></code></pre></div>
</div>
<div id="filtering-tags-example" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering-tags-example" class="anchor"></a>Filtering tags example</h2>
<p>This code uses <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_lgl</a></code> to filter the run log to only rows containing a specific tag (<code>"2 compartment"</code>).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">log_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span>(tags, <span class="op">~</span><span class="st"> "2 compartment"</span> <span class="op">%in%</span><span class="st"> </span>.x)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/collapse_to_string.html">collapse_to_string</a></span>(tags, notes) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(run, tags, notes)</a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="co">#&gt; # A tibble: 2 x 3</span></a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="co">#&gt;   run   tags                       notes                                        </span></a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                      &lt;chr&gt;                                        </span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="co">#&gt; 1 2     2 compartment              2 compartment model more appropriate than 1 …</span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9"><span class="co">#&gt; 2 3     2 compartment, combined R… Added combined error structure because it se…</span></a></code></pre></div>
</div>
</div>
<div id="further-reading" class="section level1">
<h1 class="hasAnchor">
<a href="#further-reading" class="anchor"></a>Further reading</h1>
<p>Hopefully this has given you a good start on understanding the capabilities and basic workflow of <code>rbabylon</code>. Please see the other vignettes for demonstrations of more advanced or specific functionality.</p>
<ul>
<li>
<a href="https://metrumresearchgroup.github.io/rbabylon/articles/using-based-on.html">Using the based_on field</a> – How to use the <code>based_on</code> field to track a model’s ancestry through the model development process, as well how to leverage <code><a href="../reference/config_log.html">config_log()</a></code> to check whether older models are still up-to-date.</li>
<li>
<a href="https://metrumresearchgroup.github.io/rbabylon/articles/using-summary-log.html">Creating a Model Summary Log</a> – How to use <code><a href="../reference/summary_log.html">summary_log()</a></code> to extract model diagnostics like the objective function value, condition number, and parameter counts.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#setup">Setup</a><ul class="nav nav-pills nav-stacked">
<li><a href="#installing-babylon">Installing babylon</a></li>
      <li><a href="#babylon-yaml-configuration-file">babylon.yaml configuration file</a></li>
      </ul>
</li>
      <li>
<a href="#initial-modeling-run">Initial modeling run</a><ul class="nav nav-pills nav-stacked">
<li><a href="#create-model-object">Create model object</a></li>
      <li><a href="#submit-model">Submit model</a></li>
      <li><a href="#summarize-model">Summarize model</a></li>
      </ul>
</li>
      <li>
<a href="#iteration">Iteration</a><ul class="nav nav-pills nav-stacked">
<li><a href="#copy_model_from">copy_model_from()</a></li>
      <li><a href="#adding-tags-and-notes">Adding tags and notes</a></li>
      <li><a href="#continue-to-iterate">Continue to iterate…</a></li>
      </ul>
</li>
      <li>
<a href="#run-log">Run log</a><ul class="nav nav-pills nav-stacked">
<li><a href="#viewing-tags-example">Viewing tags example</a></li>
      <li><a href="#filtering-tags-example">Filtering tags example</a></li>
      </ul>
</li>
      <li><a href="#further-reading">Further reading</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Devin Pastoor, Seth Green, Sean Wilson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
