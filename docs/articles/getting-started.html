<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started with rbabylon • rbabylon</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with rbabylon">
<meta property="og:description" content="rbabylon">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rbabylon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.1.7100</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started.html">Getting Started with rbabylon</a>
    </li>
    <li>
      <a href="../articles/parameter-labels.html">rbabylon Parameter Labels</a>
    </li>
    <li>
      <a href="../articles/using-based-on.html">Using the based_on field</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/metrumresearchgroup/rbabylon">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started with rbabylon</h1>
                        <h4 class="author">Seth Green</h4>
            
      
      
      <div class="hidden name"><code>getting-started.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This “Getting Started with rbabylon” vignette takes the user through some basic scenarios for modeling with NONMEM using <code>rbabylon</code>, introducing you to its standard workflow and functionality.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rbabylon</span>)
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>))
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">purrr</span>))</pre></body></html></div>
<p><code>rbabylon</code> is an R interface for running <code>babylon</code>. <code>babylon</code> is (will be) a complete solution for managing projects involving modeling and simulation with a number of software solutions used in pharmaceutical sciences. Currently, only NONMEM is supported, so this vignette will only address that.</p>
</div>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<div id="do-once-on-your-system" class="section level2">
<h2 class="hasAnchor">
<a href="#do-once-on-your-system" class="anchor"></a>Do once on your system</h2>
<p>The <em>first time</em> you use <code>rbabylon</code> on a system or disk, you must first install <code>babylon</code>, often aliased as <code>bbi</code>. The first time you are using it for a given project, you will also need to run <code><a href="../reference/bbi_init.html">bbi_init()</a></code> in your modeling directory.</p>
<p>To reiterate, there are two relevant paths for this section.</p>
<ul>
<li>
<code>BBI_EXE_PATH</code> – the path the <code>babylon</code> executable file on your system.</li>
<li>
<code>MODEL_DIR</code> – the root modeling directory where you will be running models with <code>rbabylon</code>
</li>
</ul>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">BBI_EXE_PATH</span> <span class="kw">&lt;-</span> <span class="st">"/data/apps/bbi"</span> <span class="co"># this should be an absolute path</span>
<span class="no">MODEL_DIR</span> <span class="kw">&lt;-</span> <span class="st">"../inst/nonmem"</span>    <span class="co"># this should be relative to your working directory</span></pre></body></html></div>
<div id="installing-babylon" class="section level3">
<h3 class="hasAnchor">
<a href="#installing-babylon" class="anchor"></a>Installing babylon</h3>
<p>You can install the <code>babylon</code> binary with:</p>
<pre><code><a href="../reference/use_bbi.html">rbabylon::use_bbi()</a></code></pre>
<p>This will install to the <code>/data/apps/</code> folder by default, which matches the <code>BBI_EXE_PATH</code> you just defined (and will use soon). If you have changed that, you can pass your custom path to the <em>directory</em> where you want to put bbi like so <code><a href="../reference/use_bbi.html">use_bbi("/some/other/dir")</a></code>. In that case, you would want to set <code>BBI_EXE_PATH = "/some/other/dir/bbi"</code>.</p>
<p>You can also check the <a href="https://github.com/metrumresearchgroup/babylon">babylon documentation</a> for manual installation instructions.</p>
<p>If you’re not sure if you have <code>babylon</code> installed, you can use <code><a href="../reference/bbi_version.html">bbi_version()</a></code> to check. This will return the version number of your installation, if one is found, or an empty string if you do <em>not</em> have <code>babylon</code> installed. You can also use <code><a href="../reference/bbi_current_release.html">bbi_current_release()</a></code> to see the most current version available and run <code><a href="../reference/use_bbi.html">use_bbi()</a></code> as specified above if you want to update.</p>
</div>
<div id="initializing-babylon" class="section level3">
<h3 class="hasAnchor">
<a href="#initializing-babylon" class="anchor"></a>Initializing babylon</h3>
<p>Next, initialize <code>babylon</code> by pointing it to your modeling directory, a working installation of NONMEM, and a default NONMEM version to use.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/bbi_init.html">bbi_init</a></span>(<span class="kw">.dir</span> <span class="kw">=</span> <span class="no">MODEL_DIR</span>,            <span class="co"># the root modeling directory</span>
         <span class="kw">.nonmem_dir</span> <span class="kw">=</span> <span class="st">"/opt/NONMEM"</span>, <span class="co"># location of NONMEM installation</span>
         <span class="kw">.nonmem_version</span> <span class="kw">=</span> <span class="st">"nm74gf"</span>)  <span class="co"># default NONMEM version to use</span></pre></body></html></div>
<p>This will create a <code>babylon.yaml</code> file in your <code>MODEL_DIR</code> directory which contains a lot of default settings for running models, etc. Those settings will not be discussed here, but know that they can be modified globally by editing that file, or model-by-model as described in the “Passing arguments to bbi” section below.</p>
</div>
</div>
<div id="do-for-each-r-session" class="section level2">
<h2 class="hasAnchor">
<a href="#do-for-each-r-session" class="anchor"></a>Do for each R session</h2>
<p>Once <code>babylon</code> is installed and initialized, you will need to make <code>rbabylon</code> knows where to find it. This can be done by setting the following options:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(
  <span class="st">'rbabylon.bbi_exe_path'</span> <span class="kw">=</span> <span class="no">BBI_EXE_PATH</span>,
  <span class="st">'rbabylon.model_directory'</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html">normalizePath</a></span>(<span class="no">MODEL_DIR</span>, <span class="kw">mustWork</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
)</pre></body></html></div>
<p>This must be set for every new R session, so it may be wise to **<code>include the above snippet in your</code>.Rprofile<code>**, replacing the</code>BBI_EXE_PATH<code>and</code>MODEL_DIR<code>constants with the relevant paths from your system/project. Note that, if setting</code>‘rbabylon.model_directory’<code>explicitly like this, you _must set it to an absolute path._ The recommended way to do this is to use</code>normalizePath(“path/to/dir/”)<code>where</code>“path/to/dir/”<code>is a relative path from the script location (in this case the</code>.Rprofile` location). That way the project will still be portable between different servers/disks.</p>
<p><em>NOTE:</em> By setting the <code>rbabylon.model_directory</code> option, you will <em>not</em> need to pass the full path to model files when calling functions like <code><a href="../reference/read_model.html">read_model()</a></code> or <code><a href="../reference/submit_model.html">submit_model()</a></code>. Instead you will pass a path relative to the specified modeling directory. To be clear, it is not <em>necessary</em> to set this option, but it is definitely a recommended convenience.</p>
</div>
</div>
<div id="initial-modeling-run" class="section level1">
<h1 class="hasAnchor">
<a href="#initial-modeling-run" class="anchor"></a>Initial modeling run</h1>
<div id="create-model-object" class="section level2">
<h2 class="hasAnchor">
<a href="#create-model-object" class="anchor"></a>Create model object</h2>
<p>To begin modeling, first create a model object. This is an S3 object with an accompanying YAML file, kept in your modeling directory. The YAML serves as the “record of truth” for the model, and will persist changes you make to the model as you go.</p>
<p>The <code>.yaml_path</code> argument should have the same name (but with a <code>.yaml</code> extension) as your base model control stream. For instance, the command below assumes you have a control stream name <code>1.ctl</code> or <code>1.mod</code> in the model directory you just defined. The <code>.description</code> argument is required and corresponds to what would be in the <code>$PROB</code> definition in a control stream.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">mod1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/new_model.html">new_model</a></span>(<span class="kw">.yaml_path</span> <span class="kw">=</span> <span class="st">"1.yaml"</span>, <span class="kw">.description</span> <span class="kw">=</span> <span class="st">"our first model"</span>)</pre></body></html></div>
<p>The model object you have just created can be passed to various functions which you will see in a minute. If you ever need to recreate it, just run <code>mod1 &lt;- read_model("1.yaml")</code> to rebuild it from the YAML. The first thing we will do is submit the model to be run.</p>
</div>
<div id="submit-model" class="section level2">
<h2 class="hasAnchor">
<a href="#submit-model" class="anchor"></a>Submit model</h2>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">mod1</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/submit_model.html">submit_model</a></span>()</pre></body></html></div>
<p>This will return a process object. We won’t discuss this object in this vignette, but other documentation will show how it can be used to check on the model run in progress. Please note that, for this first release, <strong>checking on a model run in progress is not fully implemented.</strong> For now, users should check on their runs manually and only proceed to the next steps once it has successfully completed.</p>
<div id="passing-arguments-to-bbi" class="section level3">
<h3 class="hasAnchor">
<a href="#passing-arguments-to-bbi" class="anchor"></a>Passing arguments to bbi</h3>
<p>There are a number of arguments that <code>babylon</code> can take to modify how models are run. You can print a list of available arguments using the <code><a href="../reference/print_nonmem_args.html">print_nonmem_args()</a></code> helper function. (Similar helper functions will be added as new modeling software are supported.)</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="../reference/print_nonmem_args.html">print_nonmem_args</a></span>()
<span class="co">#&gt; cache_dir (character) -- directory path for cache of nonmem executables for NM7.4+ (sets CLI flag `--cache_dir`)</span>
<span class="co">#&gt; cache_exe (character) -- name of executable stored in cache (sets CLI flag `--cache_exe`)</span>
<span class="co">#&gt; clean_lvl (numeric) -- clean level used for file output from a given (set of) runs (default 1) (sets CLI flag `--clean_lvl`)</span>
<span class="co">#&gt; config (character) -- config file (default is $HOME/babylon.yaml) (sets CLI flag `--config`)</span>
<span class="co">#&gt; copy_lvl (numeric) -- copy level used for file output from a given (set of) runs (sets CLI flag `--copy_lvl`)</span>
<span class="co">#&gt; debug (logical) -- debug mode (sets CLI flag `--debug`)</span>
<span class="co">#&gt; delay (numeric) -- Selects a random number of seconds between 1 and this value to stagger / jitter job execution. Assists in dealing with large volumes of work dealing with the same data set. May avoid NMTRAN issues about not being able read / close files (sets CLI flag `--delay`)</span>
<span class="co">#&gt; ext_file (character) -- name of custom ext-file (sets CLI flag `--ext-file`)</span>
<span class="co">#&gt; git (logical) -- whether git is used (sets CLI flag `--git`)</span>
<span class="co">#&gt; gitignore_lvl (numeric) -- gitignore lvl for a given (set of) runs (sets CLI flag `--gitignoreLvl`)</span>
<span class="co">#&gt; json (logical) -- json tree of output, if possible (sets CLI flag `--json`)</span>
<span class="co">#&gt; mpi_exec_path (character) -- The fully qualified path to mpiexec. Used for nonmem parallel operations (default '/usr/local/mpich3/bin/mpiexec') (sets CLI flag `--mpi_exec_path`)</span>
<span class="co">#&gt; nm_version (character) -- Version of nonmem from the configuration list to use (sets CLI flag `--nm_version`)</span>
<span class="co">#&gt; nm_qual (logical) -- Whether or not to execute with nmqual (autolog.pl (sets CLI flag `--nmqual`)</span>
<span class="co">#&gt; no_cor_file (logical) -- do not use cor file (sets CLI flag `--no-cor-file`)</span>
<span class="co">#&gt; no_cov_file (logical) -- do not use cov file (sets CLI flag `--no-cov-file`)</span>
<span class="co">#&gt; no_ext_file (logical) -- do not use ext file (sets CLI flag `--no-ext-file`)</span>
<span class="co">#&gt; no_grd_file (logical) -- do not use grd file (sets CLI flag `--no-grd-file`)</span>
<span class="co">#&gt; no_shk_file (logical) -- do not use shk file (sets CLI flag `--no-shk-file`)</span>
<span class="co">#&gt; nodes (numeric) -- The number of nodes on which to perform parallel operations (default 8) (sets CLI flag `--nodes`)</span>
<span class="co">#&gt; output_dir (character) -- Go template for the output directory to use for storging details of each executed model (default '{{ .Name}}') (sets CLI flag `--output_dir`)</span>
<span class="co">#&gt; overwrite (logical) -- Whether or not to remove existing output directories if they are present (sets CLI flag `--overwrite`)</span>
<span class="co">#&gt; parafile (character) -- Location of a user-provided parafile to use for parallel execution (sets CLI flag `--parafile`)</span>
<span class="co">#&gt; parallel (logical) -- Whether or not to run nonmem in parallel mode (sets CLI flag `--parallel`)</span>
<span class="co">#&gt; preview (logical) -- preview action, but don't actually run command (sets CLI flag `--preview`)</span>
<span class="co">#&gt; saveConfig (logical) -- Whether or not to save the existing configuration to a file with the model (default true) (sets CLI flag `--save_config`)</span>
<span class="co">#&gt; save_exe (character) -- what to name the executable when stored in cache (sets CLI flag `--save_exe`)</span>
<span class="co">#&gt; threads (numeric) -- number of threads to execute with (default 4) (sets CLI flag `--threads`)</span>
<span class="co">#&gt; timeout (numeric) -- The amount of time to wait for parallel operations in nonmem before timing out (default 2147483647) (sets CLI flag `--timeout`)</span>
<span class="co">#&gt; verbose (logical) -- verbose output (sets CLI flag `--verbose`)</span></pre></body></html></div>
<p>These can be specified globally in the <code>babylon.yaml</code> file, and you can see the default values of them in that file. However, they can also be specified or changed for each model. This can be done in several ways:</p>
<ul>
<li>Specifying them in the model YAML file, under the heading <code>bbi_args:</code>
</li>
<li>Manually attaching them to a model object with <code><a href="../reference/modify_model_field.html">add_bbi_args()</a></code> or <code>replace_bbi_args</code>
</li>
<li>Passing them as a named list to the <code>.bbi_args</code> argument of one of the following functions
<ul>
<li><code><a href="../reference/new_model.html">new_model()</a></code></li>
<li><code><a href="../reference/submit_model.html">submit_model()</a></code></li>
<li><code><a href="../reference/model_summary.html">model_summary()</a></code></li>
</ul>
</li>
</ul>
<p>See the docs for any of those functions for more details on usage and syntax.</p>
</div>
<div id="overwriting-output-from-previously-a-run-model" class="section level3">
<h3 class="hasAnchor">
<a href="#overwriting-output-from-previously-a-run-model" class="anchor"></a>Overwriting output from previously a run model</h3>
<p>It is common to run a model, make some tweaks to it, and then run it again. However, to avoid accidentally deleting model outputs, <code>rbabylon</code> will error by default if it sees existing output when trying to submit a model. To automatically overwrite any previous model output, just pass <code>overwrite = TRUE</code> to the <code>.bbi_args</code> argument described in the previous section. For example:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">mod1</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/submit_model.html">submit_model</a></span>(<span class="kw">.bbi_args</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>))</pre></body></html></div>
<p>You can also change this setting globally by adding <code>overwrite: true</code> to the <code>babylon.yaml</code> file for your project.</p>
</div>
</div>
<div id="summarize-model" class="section level2">
<h2 class="hasAnchor">
<a href="#summarize-model" class="anchor"></a>Summarize model</h2>
<p>Once the model run has completed, users can get a summary object containing much of the commonly used diagnostic information in a named list.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">sum1</span> <span class="kw">&lt;-</span> <span class="no">mod1</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/model_summary.html">model_summary</a></span>()
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">sum1</span>))
<span class="co">#&gt; [1] "run_details"       "run_heuristics"    "parameters_data"  </span>
<span class="co">#&gt; [4] "parameter_names"   "ofv"               "shrinkage_details"</span>
<span class="co">#&gt; [7] "covariance_theta"  "correlation_theta"</span></pre></body></html></div>
<p>These elements can be accessed manually or extracted with built-in helper functions like so:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">param_df1</span> <span class="kw">&lt;-</span> <span class="no">sum1</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/param_estimates.html">param_estimates</a></span>()
<span class="no">param_df1</span>
<span class="co">#&gt; # A tibble: 9 x 7</span>
<span class="co">#&gt;   names      estimate   stderr random_effect_sd random_effect_sdse fixed diag </span>
<span class="co">#&gt;   &lt;chr&gt;         &lt;dbl&gt;    &lt;dbl&gt;            &lt;dbl&gt;              &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt;</span>
<span class="co">#&gt; 1 THETA1       2.31   8.61e- 2           NA                NA          0 NA   </span>
<span class="co">#&gt; 2 THETA2      55.0    3.33e+ 0           NA                NA          0 NA   </span>
<span class="co">#&gt; 3 THETA3     465.     2.96e+ 1           NA                NA          0 NA   </span>
<span class="co">#&gt; 4 THETA4      -0.0806 5.55e- 2           NA                NA          0 NA   </span>
<span class="co">#&gt; 5 THETA5       4.13   1.36e+ 0           NA                NA          0 NA   </span>
<span class="co">#&gt; 6 OMEGA(1,1)   0.0964 2.00e- 2            0.311             0.0322     0 TRUE </span>
<span class="co">#&gt; 7 OMEGA(2,1)   0      1.00e+10            0       10000000000          1 FALSE</span>
<span class="co">#&gt; 8 OMEGA(2,2)   0.154  2.67e- 2            0.392             0.0341     0 TRUE </span>
<span class="co">#&gt; 9 SIGMA(1,1)   1      1.00e+10            1       10000000000          1 TRUE</span></pre></body></html></div>
</div>
</div>
<div id="iteration" class="section level1">
<h1 class="hasAnchor">
<a href="#iteration" class="anchor"></a>Iteration</h1>
<p>Much of the benefit of <code>rbabylon</code> is leveraged in the model iteration workflow, and the run log summaries that can be created afterwards. For example, imagine you look at these model results and want to begin iterating on them with a new model.</p>
<p>Imagine you are now in a new R session and no longer have your <code>mod1</code> object. You can easily rebuild it from the YAML file on disk. <em>NOTE:</em> You can pass either a character or integer to <code><a href="../reference/read_model.html">read_model()</a></code>, <code><a href="../reference/submit_model.html">submit_model()</a></code>, etc. to identify your model, assuming that you have set your model directory correctly.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">mod1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_model.html">read_model</a></span>(<span class="fl">1</span>)</pre></body></html></div>
<p>Now the user can create a new model object, based on the original, copying and renaming the control stream in the process.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">mod2</span> <span class="kw">&lt;-</span> <span class="no">mod1</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/copy_model_from.html">copy_model_from</a></span>(<span class="kw">.new_model</span> <span class="kw">=</span> <span class="fl">2</span>,
                                 <span class="kw">.description</span> <span class="kw">=</span> <span class="st">"two compartment base model"</span>)</pre></body></html></div>
<p>The new control stream file <code>2.ctl</code> can now be edited with the desired changes and then submitted and summarized exactly as above.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">mod2</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/submit_model.html">submit_model</a></span>()
<span class="no">mod2</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/model_summary.html">model_summary</a></span>()</pre></body></html></div>
<p>After looking at these results, the user can add tags, which can later be used to organize your modeling runs.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">mod1</span> <span class="kw">&lt;-</span> <span class="no">mod1</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/modify_model_field.html">add_tags</a></span>(<span class="st">"base model"</span>)
<span class="no">mod2</span> <span class="kw">&lt;-</span> <span class="no">mod2</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/modify_model_field.html">add_tags</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"base model"</span>, <span class="st">"2 compartment"</span>))</pre></body></html></div>
<p>In addition to tags, the user can add decisions that can be referenced later.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">mod2</span> <span class="kw">&lt;-</span> <span class="no">mod2</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/modify_model_field.html">add_decisions</a></span>(<span class="st">"2 compartment model more appropriate than 1 compartment"</span>)</pre></body></html></div>
<p>Now the iteration process continues.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">mod3</span> <span class="kw">&lt;-</span> <span class="no">mod2</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/copy_model_from.html">copy_model_from</a></span>(<span class="kw">.new_model</span> <span class="kw">=</span> <span class="fl">3</span>,
                  <span class="kw">.description</span> <span class="kw">=</span> <span class="st">"two compartment with residual errors"</span>)</pre></body></html></div>
<p>Submit and summarize as before.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">mod3</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/submit_model.html">submit_model</a></span>()
<span class="no">mod3</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/model_summary.html">model_summary</a></span>()</pre></body></html></div>
<p>Add tags and decisions for filtering in run log, described next.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">mod3</span> <span class="kw">&lt;-</span> <span class="no">mod3</span> <span class="kw">%&gt;%</span>
        <span class="fu"><a href="../reference/modify_model_field.html">add_tags</a></span>(<span class="st">"2 compartment"</span>) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="../reference/modify_model_field.html">add_decisions</a></span>(<span class="st">"Added residual errors because it seemed like a good idea."</span>)</pre></body></html></div>
</div>
<div id="run-log" class="section level1">
<h1 class="hasAnchor">
<a href="#run-log" class="anchor"></a>Run log</h1>
<p>At any point, the user can easily construct a run log tibble to summarize all models run up to this point.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">log_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/run_log.html">run_log</a></span>()
<span class="no">log_df</span>
<span class="co">#&gt; # A tibble: 3 x 8</span>
<span class="co">#&gt;   absolute_model_… yaml_md5 model_type description bbi_args based_on tags </span>
<span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;       &lt;list&gt;   &lt;list&gt;   &lt;lis&gt;</span>
<span class="co">#&gt; 1 /data/home/seth… 8521b38… nonmem     our first … &lt;list [… &lt;NULL&gt;   &lt;chr…</span>
<span class="co">#&gt; 2 /data/home/seth… 63ee952… nonmem     two compar… &lt;list [… &lt;chr [1… &lt;chr…</span>
<span class="co">#&gt; 3 /data/home/seth… bfa56db… nonmem     two compar… &lt;list [… &lt;chr [1… &lt;chr…</span>
<span class="co">#&gt; # … with 1 more variable: decisions &lt;list&gt;</span></pre></body></html></div>
<p>The <code><a href="../reference/run_log.html">run_log()</a></code> returns a tibble (called <code>log_df</code> in this example) which can be manipulated like any other tibble. However, several of the columns (<code>tags</code> and <code>based_on</code> for example) are list columns, which complicates how the user interacts with them. Future releases will have helper functions to more seamlessly interact with <code>log_df</code>, but until then, we have provided some sample <code>dplyr</code> code below.</p>
<div id="viewing-tags-example" class="section level2">
<h2 class="hasAnchor">
<a href="#viewing-tags-example" class="anchor"></a>Viewing tags example</h2>
<p>This example code displays a more human-readable version of the run log, with the tags collapsed to a character vector.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">log_df</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">absolute_model_path</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span>(<span class="kw">.vars</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="no">tags</span>:<span class="no">decisions</span>),
                   ~ <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">.x</span>), <span class="kw">collapse</span><span class="kw">=</span><span class="st">", "</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">absolute_model_path</span>, <span class="no">tags</span>, <span class="no">decisions</span>)
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   absolute_model_path          tags            decisions                        </span>
<span class="co">#&gt;   &lt;chr&gt;                        &lt;chr&gt;           &lt;chr&gt;                            </span>
<span class="co">#&gt; 1 /data/home/sethg/rbabylon/i… base model      ""                               </span>
<span class="co">#&gt; 2 /data/home/sethg/rbabylon/i… base model, 2 … "2 compartment model more approp…</span>
<span class="co">#&gt; 3 /data/home/sethg/rbabylon/i… 2 compartment   "Added residual errors because i…</span></pre></body></html></div>
</div>
<div id="filtering-tags-example" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering-tags-example" class="anchor"></a>Filtering tags example</h2>
<p>This code uses <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_lgl</a></code> to filter the run log to only rows containing a specific tag (<code>"2 compartment"</code>).</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">log_df</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span>(<span class="no">tags</span>, ~ <span class="st">"2 compartment"</span> <span class="kw">%in%</span> <span class="no">.x</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">absolute_model_path</span>, <span class="no">description</span>, <span class="no">tags</span>, <span class="no">decisions</span>)
<span class="co">#&gt; # A tibble: 2 x 4</span>
<span class="co">#&gt;   absolute_model_path              description                 tags    decisions</span>
<span class="co">#&gt;   &lt;chr&gt;                            &lt;chr&gt;                       &lt;list&gt;  &lt;list&gt;   </span>
<span class="co">#&gt; 1 /data/home/sethg/rbabylon/inst/… two compartment base model  &lt;chr [… &lt;chr [1]&gt;</span>
<span class="co">#&gt; 2 /data/home/sethg/rbabylon/inst/… two compartment with resid… &lt;chr [… &lt;chr [1]&gt;</span></pre></body></html></div>
</div>
</div>
<div id="further-reading" class="section level1">
<h1 class="hasAnchor">
<a href="#further-reading" class="anchor"></a>Further reading</h1>
<p>Hopefully this has given you a good start on understanding the capabilities and basic workflow of <code>rbabylon</code>. Please see the other vignettes for demonstrations of more advanced or specific functionality.</p>
<ul>
<li>
<a href="https://metrumresearchgroup.github.io/rbabylon/articles/using-based-on.html">Using the based_on field</a> – How to use the <code>based_on</code> field to track a model’s ancestry through the model development process, as well how to leverage md5 digests to check whether older models are still up-to-date.</li>
<li>
<a href="https://metrumresearchgroup.github.io/rbabylon/articles/parameter-labels.html">rbabylon Parameter Labels</a> – Extracting parameter estimates and labels into a table that can be used for diagnostics, or to generate reports.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Devin Pastoor, Seth Green, Sean Wilson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
