<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the based_on field • rbabylon</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the based_on field">
<meta property="og:description" content="rbabylon">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rbabylon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.0.8000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started.html">Getting Started with rbabylon</a>
    </li>
    <li>
      <a href="../articles/parameter-labels.html">rbabylon Parameter Labels</a>
    </li>
    <li>
      <a href="../articles/using-based-on.html">Using the based_on field</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/metrumresearchgroup/rbabylon">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the based_on field</h1>
                        <h4 class="author">Seth Green</h4>
            
      
      
      <div class="hidden name"><code>using-based-on.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette demonstrates how to use the <code>based_on</code> field to track a model’s ancestry through the model development process. You will also see one common use for this: using the tibble output from <code><a href="../reference/run_log.html">run_log()</a></code> to check that your models are up-to-date. By “up-to-date” we mean that none of the model files or data files have changed since the model was run.</p>
<p>If you are new to <code>rbabylon</code>, the <a href="getting-started.html">“Getting Started with rbabylon”</a> vignette will take you through some basic scenarios for modeling with NONMEM using <code>rbabylon</code>, introducing you to its standard workflow and functionality.</p>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>There is some initial set up necessary for using <code>rbabylon</code>. Please refer to the <a href="getting-started.html">“Getting Started”</a> vignette, mentioned above, if you have not done this yet. Once this is done, load the library and set your modeling directory.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rbabylon</span>)
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>))
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">purrr</span>))
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">fs</span>))</pre></body></html></div>
</div>
</div>
<div id="modeling-process" class="section level1">
<h1 class="hasAnchor">
<a href="#modeling-process" class="anchor"></a>Modeling process</h1>
<p>The modeling process will always start with an initial model, which we create with the <code><a href="../reference/new_model.html">new_model()</a></code> call.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">mod1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/new_model.html">new_model</a></span>(<span class="kw">.yaml_path</span> <span class="kw">=</span> <span class="st">"1.yaml"</span>, <span class="kw">.description</span> <span class="kw">=</span> <span class="st">"one compartment base model"</span>)</pre></body></html></div>
<p>From there, the iterative model development process proceeds. The <code><a href="../reference/copy_model_from.html">copy_model_from()</a></code> function will do several things, including creating a new model file and filling in some relevant metadata. Notably, it will also add the model that you copied <em>from</em> into the <code>based_on</code> field for the new model.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">mod2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/copy_model_from.html">copy_model_from</a></span>(<span class="kw">.parent_mod</span> <span class="kw">=</span> <span class="no">mod1</span>, <span class="kw">.new_model</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">.description</span> <span class="kw">=</span> <span class="st">"two compartment base model"</span>)

<span class="no">mod2</span>$<span class="no">based_on</span>
<span class="co">#&gt; [1] "1"</span></pre></body></html></div>
<p><em>NOTE:</em> In a real model development process, these models would obviously be run and the diagnostics examined before moving on. For the sake of brevity, imagine that all happens “behind the curtain” in this example. In other words, <em>in between</em> each of the calls to <code><a href="../reference/copy_model_from.html">copy_model_from()</a></code> you would be doing all of the normal iterative modeling work.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># ...submit mod2...look at diagnostics...decide on changes for next iteration...</span>

<span class="no">mod3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/copy_model_from.html">copy_model_from</a></span>(<span class="kw">.parent_mod</span> <span class="kw">=</span> <span class="no">mod2</span>, <span class="kw">.new_model</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">.description</span> <span class="kw">=</span> <span class="st">"two compartment with residual errors"</span>)

<span class="co"># ...submit mod3...look at diagnostics...decide on changes for next iteration...</span>

<span class="no">mod4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/copy_model_from.html">copy_model_from</a></span>(<span class="kw">.parent_mod</span> <span class="kw">=</span> <span class="no">mod3</span>, <span class="kw">.new_model</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">.description</span> <span class="kw">=</span> <span class="st">"two compartment with residual errors and added covariates"</span>)

<span class="co"># ...submit mod4...look at diagnostics...decide to go back to mod2 as basis for next iteration...</span>

<span class="no">mod5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/copy_model_from.html">copy_model_from</a></span>(<span class="kw">.parent_mod</span> <span class="kw">=</span> <span class="no">mod2</span>, <span class="kw">.new_model</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">.description</span> <span class="kw">=</span> <span class="st">"two compartment base model with added covariates"</span>)

<span class="co"># ...submit mod5...look at diagnostics...decide on changes for next iteration...</span>

<span class="no">mod6</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/copy_model_from.html">copy_model_from</a></span>(<span class="kw">.parent_mod</span> <span class="kw">=</span> <span class="no">mod5</span>, <span class="kw">.new_model</span> <span class="kw">=</span> <span class="fl">6</span>, <span class="kw">.description</span> <span class="kw">=</span> <span class="st">"two compartment base model with added covariates and something else"</span>)

<span class="co"># ...submit mod6...look at diagnostics...decide you're done!</span></pre></body></html></div>
<p>Now that you have arrived at your final model, you can add a tag to it, which will be used shortly for filtering the <code><a href="../reference/run_log.html">run_log()</a></code> tibble.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">mod6</span> <span class="kw">&lt;-</span> <span class="no">mod6</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/modify_model_field.html">add_tags</a></span>(<span class="st">"final model"</span>)</pre></body></html></div>
</div>
<div id="operating-on-a-model-object" class="section level1">
<h1 class="hasAnchor">
<a href="#operating-on-a-model-object" class="anchor"></a>Operating on a model object</h1>
<p>As seen above, you can simply use <code>mod$based_on</code> to see what is stored in the <code>based_on</code> field of a given model. However, there are two additional helper functions that are useful to know.</p>
<div id="get_based_on" class="section level2">
<h2 class="hasAnchor">
<a href="#get_based_on" class="anchor"></a>get_based_on</h2>
<p>First, by using <code><a href="../reference/get_based_on.html">get_based_on()</a></code> you can retrieve the absolute path to all models in the <code>based_on</code> field.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">mod6</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/get_based_on.html">get_based_on</a></span>()
<span class="co">#&gt; [1] "/data/home/sethg/rbabylon/inst/nonmem/5"</span></pre></body></html></div>
<p>This is useful because the path(s) retrieved will unambiguously identify the parent model(s) and can therefore be passed to things like <code><a href="../reference/read_model.html">read_model()</a></code> or <code><a href="../reference/model_summary.html">model_summary()</a></code> like so:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">parent_mod</span> <span class="kw">&lt;-</span> <span class="no">mod6</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/get_based_on.html">get_based_on</a></span>() <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/read_model.html">read_model</a></span>()
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">parent_mod</span>)
<span class="co">#&gt; List of 9</span>
<span class="co">#&gt;  $ description      : chr "two compartment base model with added covariates"</span>
<span class="co">#&gt;  $ based_on         : chr "2"</span>
<span class="co">#&gt;  $ model_type       : chr "nonmem"</span>
<span class="co">#&gt;  $ model_path       : chr "5.ctl"</span>
<span class="co">#&gt;  $ model_working_dir: chr "/data/home/sethg/rbabylon/inst/nonmem"</span>
<span class="co">#&gt;  $ orig_yaml_file   : chr "5.yaml"</span>
<span class="co">#&gt;  $ yaml_md5         : chr "06d4b25a18ad1a729fe0498ff9cd7f60"</span>
<span class="co">#&gt;  $ bbi_args         : list()</span>
<span class="co">#&gt;  $ output_dir       : chr "5"</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "bbi_nonmem_model" "list"</span></pre></body></html></div>
</div>
<div id="get_model_ancestry" class="section level2">
<h2 class="hasAnchor">
<a href="#get_model_ancestry" class="anchor"></a>get_model_ancestry</h2>
<p>The second helper function walks up the tree of inheritence by iteratively calling <code><a href="../reference/get_based_on.html">get_based_on()</a></code> on each parent model to determine the full set of models that led up to the current model.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">mod6</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/get_based_on.html">get_model_ancestry</a></span>()
<span class="co">#&gt; [1] "/data/home/sethg/rbabylon/inst/nonmem/1"</span>
<span class="co">#&gt; [2] "/data/home/sethg/rbabylon/inst/nonmem/2"</span>
<span class="co">#&gt; [3] "/data/home/sethg/rbabylon/inst/nonmem/5"</span></pre></body></html></div>
<p>In this case, model <code>6</code> was based on <code>5</code>, which was based on <code>2</code>, which in turn was based on <code>1</code>. You will see one example of how this can be useful in the “Final model family” section below.</p>
</div>
</div>
<div id="using-the-run-log" class="section level1">
<h1 class="hasAnchor">
<a href="#using-the-run-log" class="anchor"></a>Using the run log</h1>
<p>While it may be useful to look at the ancestry of a single model object, it may be even more useful to use the <code>based_on</code> field later in the modeling process when you are looking back and trying to summarize the model activities as a whole. The <code><a href="../reference/run_log.html">run_log()</a></code> function is helpful for this. It returns a tibble with metadata about each model.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">log_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/run_log.html">run_log</a></span>()
<span class="no">log_df</span>
<span class="co">#&gt; # A tibble: 6 x 8</span>
<span class="co">#&gt;   absolute_model_… yaml_md5 model_type description bbi_args based_on tags </span>
<span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;       &lt;list&gt;   &lt;list&gt;   &lt;lis&gt;</span>
<span class="co">#&gt; 1 /data/home/seth… 8e2bfb1… nonmem     one compar… &lt;list [… &lt;NULL&gt;   &lt;NUL…</span>
<span class="co">#&gt; 2 /data/home/seth… 7bf7577… nonmem     two compar… &lt;list [… &lt;chr [1… &lt;NUL…</span>
<span class="co">#&gt; 3 /data/home/seth… 0a39c21… nonmem     two compar… &lt;list [… &lt;chr [1… &lt;NUL…</span>
<span class="co">#&gt; 4 /data/home/seth… 685b34c… nonmem     two compar… &lt;list [… &lt;chr [1… &lt;NUL…</span>
<span class="co">#&gt; 5 /data/home/seth… 06d4b25… nonmem     two compar… &lt;list [… &lt;chr [1… &lt;NUL…</span>
<span class="co">#&gt; 6 /data/home/seth… d5aa7c4… nonmem     two compar… &lt;list [… &lt;chr [1… &lt;chr…</span>
<span class="co">#&gt; # … with 1 more variable: decisions &lt;list&gt;</span></pre></body></html></div>
<div id="filtering-tags-example" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering-tags-example" class="anchor"></a>Filtering tags example</h2>
<p>Among other things, the run log contains the tags that have been assigned to each model. Here we use <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_lgl</a></code> to filter the run log to only the final model.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">final_model_path</span> <span class="kw">&lt;-</span> <span class="no">log_df</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span>(<span class="no">tags</span>, ~ <span class="st">"final model"</span> <span class="kw">%in%</span> <span class="no">.x</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/get_path_from_object.html">get_model_path</a></span>()

<span class="no">final_model_path</span>
<span class="co">#&gt; [1] "/data/home/sethg/rbabylon/inst/nonmem/6.ctl"</span></pre></body></html></div>
<p>Next we can use the <code><a href="../reference/get_based_on.html">get_model_ancestry()</a></code> function to filter the tibble to only the models that led up to the final model.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">log_df</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">absolute_model_path</span> <span class="kw">%in%</span> <span class="fu"><a href="../reference/get_based_on.html">get_model_ancestry</a></span>(<span class="no">final_model_path</span>))
<span class="co">#&gt; # A tibble: 3 x 8</span>
<span class="co">#&gt;   absolute_model_… yaml_md5 model_type description bbi_args based_on tags </span>
<span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;       &lt;list&gt;   &lt;list&gt;   &lt;lis&gt;</span>
<span class="co">#&gt; 1 /data/home/seth… 8e2bfb1… nonmem     one compar… &lt;list [… &lt;NULL&gt;   &lt;NUL…</span>
<span class="co">#&gt; 2 /data/home/seth… 7bf7577… nonmem     two compar… &lt;list [… &lt;chr [1… &lt;NUL…</span>
<span class="co">#&gt; 3 /data/home/seth… 06d4b25… nonmem     two compar… &lt;list [… &lt;chr [1… &lt;NUL…</span>
<span class="co">#&gt; # … with 1 more variable: decisions &lt;list&gt;</span></pre></body></html></div>
<p>As you can see, models 3 and 4 are discarded because they did not lead to the final model. Review “Modeling Process” section above if you are not sure why this is the case. We will use the two techniques together in the “Final model family” section below.</p>
</div>
<div id="checking-if-models-are-up-to-date-with-config_log" class="section level2">
<h2 class="hasAnchor">
<a href="#checking-if-models-are-up-to-date-with-config_log" class="anchor"></a>Checking if models are up-to-date with config_log()</h2>
<p>Now imagine you are coming back to this project some time later and want to make sure that all of the outputs you have are still up-to-date with the model files and data currently in the project.</p>
<p>When <code>babylon</code> runs a model, it creates a file named <code>bbi_config.json</code> in the output directory. This file contains a lot of information about the state and configuration at runtime. Notably, it contains an md5 digest of both the model file <em>and</em> the data file at run time. Users can compare this to the <em>current</em> md5 hashes of these two files to check if any model or data files have changed <em>since the model was last run</em>. This serves as a check that the outputs are up-to-date with the model and data.</p>
<p>You can call <code>config_log</code> directly, but it is likely more useful to join the two together automatically with <code>run_log() %&gt;% add_config()</code>.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">log_df</span> <span class="kw">&lt;-</span> <span class="no">log_df</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/config_log.html">add_config</a></span>()
<span class="no">log_df</span>
<span class="co">#&gt; # A tibble: 6 x 11</span>
<span class="co">#&gt;   absolute_model_… yaml_md5 model_type description bbi_args based_on tags </span>
<span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;       &lt;list&gt;   &lt;list&gt;   &lt;lis&gt;</span>
<span class="co">#&gt; 1 /data/home/seth… 8e2bfb1… nonmem     one compar… &lt;list [… &lt;NULL&gt;   &lt;NUL…</span>
<span class="co">#&gt; 2 /data/home/seth… 7bf7577… nonmem     two compar… &lt;list [… &lt;chr [1… &lt;NUL…</span>
<span class="co">#&gt; 3 /data/home/seth… 0a39c21… nonmem     two compar… &lt;list [… &lt;chr [1… &lt;NUL…</span>
<span class="co">#&gt; 4 /data/home/seth… 685b34c… nonmem     two compar… &lt;list [… &lt;chr [1… &lt;NUL…</span>
<span class="co">#&gt; 5 /data/home/seth… 06d4b25… nonmem     two compar… &lt;list [… &lt;chr [1… &lt;NUL…</span>
<span class="co">#&gt; 6 /data/home/seth… d5aa7c4… nonmem     two compar… &lt;list [… &lt;chr [1… &lt;chr…</span>
<span class="co">#&gt; # … with 4 more variables: decisions &lt;list&gt;, model_md5 &lt;chr&gt;, data_path &lt;chr&gt;,</span>
<span class="co">#&gt; #   data_md5 &lt;chr&gt;</span></pre></body></html></div>
<p>Now you can easily check the md5 digests from the config log against those of the current files.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co"># extract path to data files and model files</span>
<span class="no">norm_data_paths</span> <span class="kw">&lt;-</span> <span class="kw pkg">fs</span><span class="kw ns">::</span><span class="fu"><a href="http://fs.r-lib.org/reference/path_math.html">path_norm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">log_df</span>$<span class="no">absolute_model_path</span>, <span class="no">log_df</span>$<span class="no">data_path</span>))
<span class="no">norm_model_paths</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_path_from_object.html">get_model_path</a></span>(<span class="no">log_df</span>)

<span class="co"># get md5 digests and compare to those from config_log() columns</span>
<span class="no">log_df</span> <span class="kw">&lt;-</span> <span class="no">log_df</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
                        <span class="kw">current_data_md5</span>  <span class="kw">=</span> <span class="kw pkg">tools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/tools/md5sum.html">md5sum</a></span>(<span class="no">norm_data_paths</span>),
                        <span class="kw">data_md5_match</span>    <span class="kw">=</span> <span class="no">.data</span>$<span class="no">data_md5</span> <span class="kw">==</span> <span class="no">.data</span>$<span class="no">current_data_md5</span>,
                        <span class="kw">current_model_md5</span>  <span class="kw">=</span> <span class="kw pkg">tools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/tools/md5sum.html">md5sum</a></span>(<span class="no">norm_model_paths</span>),
                        <span class="kw">model_md5_match</span>   <span class="kw">=</span> <span class="no">.data</span>$<span class="no">model_md5</span> <span class="kw">==</span> <span class="no">.data</span>$<span class="no">current_model_md5</span>
                      )

<span class="no">log_df</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">absolute_model_path</span>, <span class="no">data_md5_match</span>, <span class="no">model_md5_match</span>)
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   absolute_model_path                     data_md5_match model_md5_match</span>
<span class="co">#&gt;   &lt;chr&gt;                                   &lt;lgl&gt;          &lt;lgl&gt;          </span>
<span class="co">#&gt; 1 /data/home/sethg/rbabylon/inst/nonmem/1 TRUE           TRUE           </span>
<span class="co">#&gt; 2 /data/home/sethg/rbabylon/inst/nonmem/2 TRUE           TRUE           </span>
<span class="co">#&gt; 3 /data/home/sethg/rbabylon/inst/nonmem/3 TRUE           FALSE          </span>
<span class="co">#&gt; 4 /data/home/sethg/rbabylon/inst/nonmem/4 TRUE           FALSE          </span>
<span class="co">#&gt; 5 /data/home/sethg/rbabylon/inst/nonmem/5 TRUE           TRUE           </span>
<span class="co">#&gt; 6 /data/home/sethg/rbabylon/inst/nonmem/6 TRUE           TRUE</span></pre></body></html></div>
</div>
<div id="final-model-family" class="section level2">
<h2 class="hasAnchor">
<a href="#final-model-family" class="anchor"></a>Final model family</h2>
<p>From the <code>model_md5_match</code> column in the previous example, you can see that some of the model files have changed since they were run. However, you may only care about your final model and the models that led to it.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">final_model_family</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(
  <span class="no">log_df</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">absolute_model_path</span> <span class="kw">%in%</span> <span class="fu"><a href="../reference/get_based_on.html">get_model_ancestry</a></span>(<span class="no">final_model_path</span>)), <span class="co"># the ancestors of the final model</span>
  <span class="no">log_df</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span>(<span class="no">tags</span>, ~ <span class="st">"final model"</span> <span class="kw">%in%</span> <span class="no">.x</span>)) <span class="co"># the final model itself</span>
)
<span class="no">final_model_family</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">absolute_model_path</span>, <span class="no">data_md5_match</span>, <span class="no">model_md5_match</span>)
<span class="co">#&gt; # A tibble: 4 x 3</span>
<span class="co">#&gt;   absolute_model_path                     data_md5_match model_md5_match</span>
<span class="co">#&gt;   &lt;chr&gt;                                   &lt;lgl&gt;          &lt;lgl&gt;          </span>
<span class="co">#&gt; 1 /data/home/sethg/rbabylon/inst/nonmem/1 TRUE           TRUE           </span>
<span class="co">#&gt; 2 /data/home/sethg/rbabylon/inst/nonmem/2 TRUE           TRUE           </span>
<span class="co">#&gt; 3 /data/home/sethg/rbabylon/inst/nonmem/5 TRUE           TRUE           </span>
<span class="co">#&gt; 4 /data/home/sethg/rbabylon/inst/nonmem/6 TRUE           TRUE</span></pre></body></html></div>
<p>When we filter to only those models, you can see that they are all still up-to-date. Great news.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Devin Pastoor, Seth Green, Sean Wilson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
