<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the based_on field • bbr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the based_on field">
<meta property="og:description" content="bbr">
<meta property="og:image" content="https://metrumresearchgroup.github.io/bbr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bbr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started.html">Getting Started with bbr</a>
    </li>
    <li>
      <a href="../articles/parameter-labels.html">bbr Parameter Labels</a>
    </li>
    <li>
      <a href="../articles/using-based-on.html">Using the based_on field</a>
    </li>
    <li>
      <a href="../articles/using-summary-log.html">Creating a Model Summary Log</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/metrumresearchgroup/bbr">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="using-based-on_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the based_on field</h1>
                        <h4 class="author">Seth Green</h4>
            
      
      
      <div class="hidden name"><code>using-based-on.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette demonstrates how to use the <code>based_on</code> field to track a model’s ancestry through the model development process. You will also see one common use for this: using the tibble output from <code><a href="../reference/config_log.html">config_log()</a></code> to check that your models are up-to-date. By “up-to-date” we mean that none of the model files or data files have changed since the model was run.</p>
<p>If you are new to <code>bbr</code>, the <a href="https://metrumresearchgroup.github.io/bbr/articles/getting-started.html">“Getting Started with bbr”</a> vignette will take you through some basic scenarios for modeling with NONMEM using <code>bbr</code>, introducing you to its standard workflow and functionality.</p>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>There is some initial set up necessary for using <code>bbr</code>. Please refer to the <a href="https://metrumresearchgroup.github.io/bbr/articles/getting-started.html#setup">“Getting Started”</a> vignette, mentioned above, if you have not done this yet. Once this is done, load the library.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">bbr</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="modeling-process" class="section level1">
<h1 class="hasAnchor">
<a href="#modeling-process" class="anchor"></a>Modeling process</h1>
<p>The modeling process will always start with an initial model, which we create with the <code><a href="../reference/new_model.html">new_model()</a></code> call.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MODEL_DIR</span> <span class="op">&lt;-</span> <span class="st">"../nonmem"</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_model.html">new_model</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">MODEL_DIR</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>From there, the iterative model development process proceeds. The <code><a href="../reference/copy_model_from.html">copy_model_from()</a></code> function will do several things, including creating a new model file and filling in some relevant metadata. Notably, it will also add the model that you copied <em>from</em> into the <code>based_on</code> field for the new model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/copy_model_from.html">copy_model_from</a></span><span class="op">(</span>.parent_mod <span class="op">=</span> <span class="va">mod1</span>, .new_model <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="../reference/get_based_on.html">get_based_on</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span>
<span class="co">#&gt; [1] "/data/home/sethg/bbr/renv/library/R-4.0/x86_64-pc-linux-gnu/bbr/model/nonmem/basic/1"</span></code></pre></div>
<div id="diff-helpers" class="section level2">
<h2 class="hasAnchor">
<a href="#diff-helpers" class="anchor"></a>diff helpers</h2>
<p>There are several helper functions for comparing a model to its parent. <code><a href="../reference/tags_diff.html">tags_diff()</a></code> compares the tags attached to the two models, while <code><a href="../reference/model_diff.html">model_diff()</a></code> compares the model files on disk.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modify_tags.html">add_tags</a></span><span class="op">(</span><span class="va">mod1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"the same tag"</span>, <span class="st">"an old tag"</span><span class="op">)</span><span class="op">)</span>
<span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modify_tags.html">add_tags</a></span><span class="op">(</span><span class="va">mod2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"the same tag"</span>, <span class="st">"a new tag"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/tags_diff.html">tags_diff</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span>
<span class="co">#&gt; In 2 but not parent(s):  a new tag</span>
<span class="co">#&gt; In parent(s) but not 2:  an old tag</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model_diff.html">model_diff</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span></code></pre></div>
<style type="text/css">
/* Structural CSS ------------------------------------------------------------*/
/*
 * TBD whether we want a more fully table like structure; some of the visual
 * cues provided by the current set-up are useful (line wraps, etc.)
 */

DIV.diffobj-container PRE.diffobj-content {
  white-space: pre-wrap;
  margin: 0;
}
DIV.diffobj-container DIV.diffobj-row {
  width: 100%;
  font-family: monospace;
  display: table;
  table-layout: fixed;
}
DIV.diffobj-container DIV.diffobj-line {
  width: auto;
  display: table-cell;
  overflow: hidden;
}
DIV.diffobj-container DIV.diffobj-line>DIV {
  width: 100%;
  display: table;
  table-layout: auto;
}
DIV.diffobj-container DIV.diffobj-line.banner>DIV {
  display: table;
  table-layout: auto; /* set to fixed in JS */
}
DIV.diffobj-container DIV.diffobj-text {
  display: table-cell;
  width: 100%;
}
DIV.diffobj-container DIV.diffobj-gutter {
  display: table-cell;
  padding: 0 0.2em;
}
DIV.diffobj-container DIV.diffobj-gutter DIV {
  display: table-cell;
}
#diffobj_content_meta DIV.diffobj-container DIV.diffobj-row {
  width: auto;
}
#diffobj_banner_meta DIV.diffobj-container DIV.diffobj-line.banner>DIV {
  table-layout: auto;
}
#diffobj_outer {
  overflow: hidden;
}
/* Summary -------------------------------------------------------------------*/ 

DIV.diffobj-container DIV.diffobj-summary DIV.map {
  word-wrap: break-word;
  padding-left: 1em;
}
DIV.diffobj-container DIV.diffobj-summary DIV.detail {
  padding-left: 1em;
}

/* Common elements -----------------------------------------------------------*/

DIV.diffobj-container DIV.diffobj-line.banner {
  font-size: 1.2em;
  font-weight: bold;
  overflow: hidden;
}
/* truncate banners */
DIV.diffobj-container DIV.diffobj-line.banner DIV.diffobj-text DIV{
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 100%;             /* need to compute and set in JS */
}
DIV.diffobj-container DIV.diffobj-gutter,
DIV.diffobj-container DIV.diffobj-guide,
DIV.diffobj-container DIV.diffobj-fill,
DIV.diffobj-container DIV.context_sep,
DIV.diffobj-container SPAN.diffobj-trim {
  color: #999;
}
DIV.diffobj-container DIV.diffobj-header {
  font-size: 1.1em;
}
DIV.diffobj-container DIV.diffobj-text>DIV.diffobj-match,
DIV.diffobj-container DIV.diffobj-text>DIV.diffobj-guide {
  background-color: #ffffff;
}
DIV.diffobj-container DIV.diffobj-text>DIV.diffobj-fill {
  background-color: transparent;
}
DIV.diffobj-container DIV.diffobj-text>DIV {
  padding-right: 3px;
}
DIV.diffobj-container DIV.diffobj-text>DIV {
  border-left: 1px solid #888888;
}
DIV.diffobj-container DIV.diffobj-line {
  background-color: #eeeeee;
}
DIV.diffobj-container DIV.diffobj-text>DIV,
DIV.diffobj-container DIV.diffobj-header {
  padding-left: 0.5em;
}
DIV.diffobj-container DIV.diffobj-line>DIV.diffobj-match,
DIV.diffobj-container DIV.diffobj-line>DIV.diffobj-fill,
DIV.diffobj-container DIV.diffobj-line>DIV.diffobj-guide {
  border-left: 1px solid #888888;
}
/* github inspired color scheme - default ------------------------------------*/

DIV.diffobj-container.light.rgb SPAN.diffobj-word.insert,
DIV.diffobj-container.light.rgb DIV.diffobj-line>DIV.insert {
  background-color: #a6f3a6;
}
DIV.diffobj-container.light.rgb SPAN.diffobj-word.delete,
DIV.diffobj-container.light.rgb DIV.diffobj-line>DIV.delete {
  background-color: #f8c2c2;
}
DIV.diffobj-container.light.rgb DIV.diffobj-text>DIV.insert {
  background-color: #efffef;
}
DIV.diffobj-container.light.rgb DIV.diffobj-text>DIV.insert,
DIV.diffobj-container.light.rgb DIV.diffobj-line>DIV.insert {
  border-left: 1px solid #33bb33;
}
DIV.diffobj-container.light.rgb DIV.diffobj-text>DIV.delete {
  background-color: #ffefef;
}
DIV.diffobj-container.light.rgb DIV.diffobj-text>DIV.delete,
DIV.diffobj-container.light.rgb DIV.diffobj-line>DIV.delete {
  border-left: 1px solid #cc6666;
}
DIV.diffobj-container.light.rgb DIV.diffobj-header {
  background-color: #e0e6fa;
  border-left: 1px solid #9894b6;
}
/* Yellow Blue variation -----------------------------------------------------*/

DIV.diffobj-container.light.yb SPAN.diffobj-word.insert,
DIV.diffobj-container.light.yb DIV.diffobj-line>DIV.insert {
  background-color: #c0cfff;
}
DIV.diffobj-container.light.yb SPAN.diffobj-word.delete,
DIV.diffobj-container.light.yb DIV.diffobj-line>DIV.delete {
  background-color: #e7e780;
}
DIV.diffobj-container.light.yb DIV.diffobj-text>DIV.insert {
  background-color: #efefff;
}
DIV.diffobj-container.light.yb DIV.diffobj-text>DIV.insert,
DIV.diffobj-container.light.yb DIV.diffobj-line>DIV.insert {
  border-left: 1px solid #3333bb;
}
DIV.diffobj-container.light.yb DIV.diffobj-text>DIV.delete {
  background-color: #fefee5;
}
DIV.diffobj-container.light.yb DIV.diffobj-text>DIV.delete,
DIV.diffobj-container.light.yb DIV.diffobj-line>DIV.delete {
  border-left: 1px solid #aaaa55;
}
DIV.diffobj-container.light.yb DIV.diffobj-header {
  background-color: #afafaf;
  border-left: 1px solid #e3e3e3;
  color: #e9e9e9;
}
DIV.diffobj-container.light.yb DIV.diffobj-line {
  background-color: #eeeeee;
}
</style>
<div class="diffobj-container light yb">
<pre class="diffobj-content"><div class="diffobj-row">
<div class="diffobj-line banner"><div class="delete">
<div class="diffobj-gutter">
<div class="delete">&lt;</div>
<div class="pad"> </div>
</div>
<div class="diffobj-text"><div class="delete"><span class="diffobj-word delete">2</span></div></div>
</div></div>
<div class="diffobj-line banner"><div class="insert">
<div class="diffobj-gutter">
<div class="insert">&gt;</div>
<div class="pad"> </div>
</div>
<div class="diffobj-text"><div class="insert"><span class="diffobj-word insert">1</span></div></div>
</div></div>
</div><div class="diffobj-row">
<div class="diffobj-line"><div class="diffobj-header">@@ 1,3 @@</div></div>
<div class="diffobj-line"><div class="diffobj-header">@@ 1,3 @@</div></div>
</div><div class="diffobj-row">
<div class="diffobj-line"><div class="delete">
<div class="diffobj-gutter">
<div class="delete">&lt;</div>
<div class="pad"> </div>
</div>
<div class="diffobj-text"><div class="delete">
<span class="diffobj-trim"></span>$PROBLEM <span class="diffobj-word delete">From</span> <span class="diffobj-word delete">bbr</span><span class="diffobj-word delete">:</span> <span class="diffobj-word delete">see</span> <span class="diffobj-word delete">2.yaml</span> <span class="diffobj-word delete">for</span> <span class="diffobj-word delete">details</span><span class="diffobj-trim"></span>
</div></div>
</div></div>
<div class="diffobj-line"><div class="insert">
<div class="diffobj-gutter">
<div class="insert">&gt;</div>
<div class="pad"> </div>
</div>
<div class="diffobj-text"><div class="insert">
<span class="diffobj-trim"></span>$PROBLEM <span class="diffobj-word insert">PK</span> <span class="diffobj-word insert">model</span> <span class="diffobj-word insert">1</span> <span class="diffobj-word insert">cmt</span> <span class="diffobj-word insert">base</span><span class="diffobj-trim"></span>
</div></div>
</div></div>
</div><div class="diffobj-row">
<div class="diffobj-line"><div class="diffobj-match">
<div class="diffobj-gutter">
<div class="diffobj-match"> </div>
<div class="pad"> </div>
</div>
<div class="diffobj-text"><div class="diffobj-match"> </div></div>
</div></div>
<div class="diffobj-line"><div class="diffobj-match">
<div class="diffobj-gutter">
<div class="diffobj-match"> </div>
<div class="pad"> </div>
</div>
<div class="diffobj-text"><div class="diffobj-match"> </div></div>
</div></div>
</div><div class="diffobj-row">
<div class="diffobj-line"><div class="diffobj-match">
<div class="diffobj-gutter">
<div class="diffobj-match"> </div>
<div class="pad"> </div>
</div>
<div class="diffobj-text"><div class="diffobj-match">
<span class="diffobj-trim"></span>$INPUT ID TIME MDV EVID DV AMT  SEX WT ETN<span class="diffobj-trim"></span>
</div></div>
</div></div>
<div class="diffobj-line"><div class="diffobj-match">
<div class="diffobj-gutter">
<div class="diffobj-match"> </div>
<div class="pad"> </div>
</div>
<div class="diffobj-text"><div class="diffobj-match">
<span class="diffobj-trim"></span>$INPUT ID TIME MDV EVID DV AMT  SEX WT ETN<span class="diffobj-trim"></span>
</div></div>
</div></div>
</div></pre>
</div>
<p>By default both functions compare the model to whatever model is returned from <code><a href="../reference/get_based_on.html">get_based_on()</a></code>, but they also have a <code>.mod2</code> argument which can take any arbitrary model object and compare with that instead. See <code><a href="../reference/tags_diff.html">?tags_diff</a></code> and <code><a href="../reference/model_diff.html">?model_diff</a></code> for more details on usage.</p>
</div>
<div id="more-iteration" class="section level2">
<h2 class="hasAnchor">
<a href="#more-iteration" class="anchor"></a>More iteration</h2>
<p>Now we continue iterating on our model. <em>NOTE:</em> In a real model development process, these models would obviously be run and the diagnostics examined before moving on. For the sake of brevity, imagine that all happens “behind the curtain” in this example. In other words, <em>in between</em> each of the calls to <code><a href="../reference/copy_model_from.html">copy_model_from()</a></code> you would be doing all of the normal iterative modeling work.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ...submit mod2...look at diagnostics...decide on changes for next iteration...</span>

<span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/copy_model_from.html">copy_model_from</a></span><span class="op">(</span><span class="va">mod2</span>, <span class="fl">3</span><span class="op">)</span>

<span class="co"># ...submit mod3...look at diagnostics...decide on changes for next iteration...</span>

<span class="va">mod4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/copy_model_from.html">copy_model_from</a></span><span class="op">(</span><span class="va">mod3</span>, <span class="fl">4</span><span class="op">)</span>

<span class="co"># ...submit mod4...look at diagnostics...decide to go back to mod2 as basis for next iteration...</span>

<span class="va">mod5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/copy_model_from.html">copy_model_from</a></span><span class="op">(</span><span class="va">mod2</span>, <span class="fl">5</span><span class="op">)</span>

<span class="co"># ...submit mod5...look at diagnostics...decide on changes for next iteration...</span>

<span class="va">mod6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/copy_model_from.html">copy_model_from</a></span><span class="op">(</span><span class="va">mod5</span>, <span class="fl">6</span><span class="op">)</span>

<span class="co"># ...submit mod6...look at diagnostics...decide you're done!</span></code></pre></div>
<p>Now that you have arrived at your final model, you can add a description to identify it, which will be used shortly for filtering the <code><a href="../reference/run_log.html">run_log()</a></code> tibble.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod6</span> <span class="op">&lt;-</span> <span class="va">mod6</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/modify_description.html">add_description</a></span><span class="op">(</span><span class="st">"Final model"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="operating-on-a-model-object" class="section level1">
<h1 class="hasAnchor">
<a href="#operating-on-a-model-object" class="anchor"></a>Operating on a model object</h1>
<p>As seen above, you can simply use <code>mod$based_on</code> to see what is stored in the <code>based_on</code> field of a given model. However, there are two additional helper functions that are useful to know.</p>
<div id="get_based_on" class="section level2">
<h2 class="hasAnchor">
<a href="#get_based_on" class="anchor"></a>get_based_on</h2>
<p>First, by using <code><a href="../reference/get_based_on.html">get_based_on()</a></code> you can retrieve the absolute path to all models in the <code>based_on</code> field.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod6</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_based_on.html">get_based_on</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "/data/home/sethg/bbr/renv/library/R-4.0/x86_64-pc-linux-gnu/bbr/model/nonmem/basic/5"</span></code></pre></div>
<p>This is useful because the path(s) retrieved will unambiguously identify the parent model(s) and can therefore be passed to things like <code><a href="../reference/read_model.html">read_model()</a></code> or <code><a href="../reference/model_summary.html">model_summary()</a></code> like so:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">parent_mod</span> <span class="op">&lt;-</span> <span class="va">mod6</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_based_on.html">get_based_on</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/read_model.html">read_model</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">parent_mod</span><span class="op">)</span>
<span class="co">#&gt; List of 4</span>
<span class="co">#&gt;  $ model_type         : chr "nonmem"</span>
<span class="co">#&gt;  $ based_on           : chr "2"</span>
<span class="co">#&gt;  $ absolute_model_path: chr "/data/home/sethg/bbr/renv/library/R-4.0/x86_64-pc-linux-gnu/bbr/model/nonmem/basic/5"</span>
<span class="co">#&gt;  $ yaml_md5           : chr "ac0ba292b017a72bb316359f0df09bb2"</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:3] "bbi_nonmem_model" "bbi_model" "list"</span></code></pre></div>
</div>
<div id="get_model_ancestry" class="section level2">
<h2 class="hasAnchor">
<a href="#get_model_ancestry" class="anchor"></a>get_model_ancestry</h2>
<p>The second helper function walks up the tree of inheritence by iteratively calling <code><a href="../reference/get_based_on.html">get_based_on()</a></code> on each parent model to determine the full set of models that led up to the current model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod6</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_based_on.html">get_model_ancestry</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "/data/home/sethg/bbr/renv/library/R-4.0/x86_64-pc-linux-gnu/bbr/model/nonmem/basic/1"</span>
<span class="co">#&gt; [2] "/data/home/sethg/bbr/renv/library/R-4.0/x86_64-pc-linux-gnu/bbr/model/nonmem/basic/2"</span>
<span class="co">#&gt; [3] "/data/home/sethg/bbr/renv/library/R-4.0/x86_64-pc-linux-gnu/bbr/model/nonmem/basic/5"</span></code></pre></div>
<p>In this case, model <code>6</code> was based on <code>5</code>, which was based on <code>2</code>, which in turn was based on <code>1</code>. You will see one example of how this can be useful in the “Final model family” section below.</p>
</div>
</div>
<div id="using-the-run-log" class="section level1">
<h1 class="hasAnchor">
<a href="#using-the-run-log" class="anchor"></a>Using the run log</h1>
<p>While it may be useful to look at the ancestry of a single model object, it may be even more useful to use the <code>based_on</code> field later in the modeling process when you are looking back and trying to summarize the model activities as a whole. The <code><a href="../reference/run_log.html">run_log()</a></code> function is helpful for this. It returns a tibble with metadata about each model.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">log_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_log.html">run_log</a></span><span class="op">(</span><span class="va">MODEL_DIR</span><span class="op">)</span>
<span class="va">log_df</span>
<span class="co">#&gt; # A tibble: 6 x 10</span>
<span class="co">#&gt;   absolute_model_… run   yaml_md5 model_type description bbi_args based_on tags </span>
<span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;       &lt;list&gt;   &lt;list&gt;   &lt;lis&gt;</span>
<span class="co">#&gt; 1 /data/home/seth… 1     5ec8e22… nonmem     &lt;NA&gt;        &lt;NULL&gt;   &lt;NULL&gt;   &lt;chr…</span>
<span class="co">#&gt; 2 /data/home/seth… 2     9adbb90… nonmem     &lt;NA&gt;        &lt;NULL&gt;   &lt;chr [1… &lt;chr…</span>
<span class="co">#&gt; 3 /data/home/seth… 3     ac0ba29… nonmem     &lt;NA&gt;        &lt;NULL&gt;   &lt;chr [1… &lt;NUL…</span>
<span class="co">#&gt; 4 /data/home/seth… 4     6818db1… nonmem     &lt;NA&gt;        &lt;NULL&gt;   &lt;chr [1… &lt;NUL…</span>
<span class="co">#&gt; 5 /data/home/seth… 5     ac0ba29… nonmem     &lt;NA&gt;        &lt;NULL&gt;   &lt;chr [1… &lt;NUL…</span>
<span class="co">#&gt; 6 /data/home/seth… 6     feb9bf3… nonmem     Final model &lt;NULL&gt;   &lt;chr [1… &lt;NUL…</span>
<span class="co">#&gt; # … with 2 more variables: notes &lt;list&gt;, decisions &lt;list&gt;</span></code></pre></div>
<p>Among other things, the run log contains any descriptions that have been assigned to each model. Here we use <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/pull.html">dplyr::pull()</a></code> to get the path to the final model.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">final_model_path</span> <span class="op">&lt;-</span> 
  <span class="va">log_df</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">description</span> <span class="op">==</span> <span class="st">"Final model"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">absolute_model_path</span><span class="op">)</span>

<span class="va">final_model_path</span>
<span class="co">#&gt; [1] "/data/home/sethg/bbr/renv/library/R-4.0/x86_64-pc-linux-gnu/bbr/model/nonmem/basic/6"</span></code></pre></div>
<p>Next we can use the <code><a href="../reference/get_based_on.html">get_model_ancestry()</a></code> function to filter the tibble to only the models that led up to the final model.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">log_df</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">absolute_model_path</span> <span class="op">%in%</span> <span class="fu"><a href="../reference/get_based_on.html">get_model_ancestry</a></span><span class="op">(</span><span class="va">final_model_path</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/collapse_to_string.html">collapse_to_string</a></span><span class="op">(</span><span class="va">based_on</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># collapses list column for easier printing</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">run</span>, <span class="va">based_on</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   run   based_on</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;   </span>
<span class="co">#&gt; 1 1     &lt;NA&gt;    </span>
<span class="co">#&gt; 2 2     1       </span>
<span class="co">#&gt; 3 5     2</span></code></pre></div>
<p>As you can see, models 3 and 4 are discarded because they did not lead to the final model. Review “Modeling Process” section above if you are not sure why this is the case. We will use the two techniques together in the “Final model family” section below.</p>
<div id="checking-if-models-are-up-to-date-with-check_up_to_date-and-config_log" class="section level2">
<h2 class="hasAnchor">
<a href="#checking-if-models-are-up-to-date-with-check_up_to_date-and-config_log" class="anchor"></a>Checking if models are up-to-date with <code>check_up_to_date()</code> and <code>config_log()</code>
</h2>
<p>Now imagine you are coming back to this project some time later and want to make sure that all of the outputs you have are still up-to-date with the model files and data currently in the project.</p>
<p>When <code>bbi</code> runs a model, it creates a file named <code>bbi_config.json</code> in the output directory. This file contains a lot of information about the state and configuration at the time when the model was run. Notably, it contains an md5 digest of both the model file <em>and</em> the data file at execution time. The following functions compare the md5 digests (stored during model execution) against the model and data files <em>as they currently exist on disk</em> at the time these functions are called.</p>
<div id="check_up_to_date-for-a-single-model" class="section level3">
<h3 class="hasAnchor">
<a href="#check_up_to_date-for-a-single-model" class="anchor"></a><code>check_up_to_date()</code> for a single model</h3>
<p>The <code><a href="../reference/check_up_to_date.html">check_up_to_date()</a></code> function takes a model object and invisibly returns a two-element logical vector. The return is invisible because, if there are any changes, it will also print a message telling you which files have changed. Either way, you can also inspect the returned object like so.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_up_to_date.html">check_up_to_date</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="co">#&gt; model  data </span>
<span class="co">#&gt;  TRUE  TRUE</span></code></pre></div>
</div>
<div id="config_log-for-multiple-models" class="section level3">
<h3 class="hasAnchor">
<a href="#config_log-for-multiple-models" class="anchor"></a><code>config_log()</code> for multiple models</h3>
<p>The <code><a href="../reference/config_log.html">config_log()</a></code> function parses these <code>bbi_config.json</code> files and extracts some relevant information to a <code>bbi_config_log_df</code> tibble. It contains <code>model_has_changed</code> and <code>data_has_changed</code> columns that serve as a check that the outputs are up-to-date with the current model and data.</p>
<p>You can call <code>config_log</code> directly, but it is often useful to join it to a run log automatically with <code>run_log() %&gt;% add_config()</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">log_df</span> <span class="op">&lt;-</span> <span class="va">log_df</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/config_log.html">add_config</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">log_df</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">run</span>, <span class="va">model_has_changed</span>, <span class="va">data_has_changed</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   run   model_has_changed data_has_changed</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;lgl&gt;             &lt;lgl&gt;           </span>
<span class="co">#&gt; 1 1     FALSE             FALSE           </span>
<span class="co">#&gt; 2 2     FALSE             FALSE           </span>
<span class="co">#&gt; 3 3     TRUE              FALSE           </span>
<span class="co">#&gt; 4 4     TRUE              FALSE           </span>
<span class="co">#&gt; 5 5     FALSE             FALSE           </span>
<span class="co">#&gt; 6 6     FALSE             FALSE</span></code></pre></div>
<p>One important note: <code><a href="../reference/check_up_to_date.html">check_up_to_date()</a></code> and <code><a href="../reference/config_log.html">config_log()</a></code> return opposite boolean values. <code><a href="../reference/check_up_to_date.html">check_up_to_date()</a></code> returns <code>TRUE</code> if the files are <em>up to date</em>, whereas the <code>*_has_changed</code> columns contain <code>TRUE</code> if something <em>has changed</em>.</p>
</div>
</div>
<div id="final-model-family" class="section level2">
<h2 class="hasAnchor">
<a href="#final-model-family" class="anchor"></a>Final model family</h2>
<p>From the <code>model_has_changed</code> column in the previous example, you can see that some of the model files have changed since they were run. However, you may only care about your final model and the models that led to it. You can use the <code>description</code> and <code>based_on</code> columns from the <code><a href="../reference/run_log.html">run_log()</a></code> to filter to only those models.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">final_model_family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>
  <span class="va">log_df</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">absolute_model_path</span> <span class="op">%in%</span> <span class="fu"><a href="../reference/get_based_on.html">get_model_ancestry</a></span><span class="op">(</span><span class="va">final_model_path</span><span class="op">)</span><span class="op">)</span>, <span class="co"># the ancestors of the final model</span>
  <span class="va">log_df</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">description</span> <span class="op">==</span> <span class="st">"Final model"</span><span class="op">)</span> <span class="co"># the final model itself</span>
<span class="op">)</span>

<span class="va">final_model_family</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/collapse_to_string.html">collapse_to_string</a></span><span class="op">(</span><span class="va">based_on</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">run</span>, <span class="va">based_on</span>, <span class="va">description</span>, <span class="va">model_has_changed</span>, <span class="va">data_has_changed</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4 x 5</span>
<span class="co">#&gt;   run   based_on description model_has_changed data_has_changed</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;       &lt;lgl&gt;             &lt;lgl&gt;           </span>
<span class="co">#&gt; 1 1     &lt;NA&gt;     &lt;NA&gt;        FALSE             FALSE           </span>
<span class="co">#&gt; 2 2     1        &lt;NA&gt;        FALSE             FALSE           </span>
<span class="co">#&gt; 3 5     2        &lt;NA&gt;        FALSE             FALSE           </span>
<span class="co">#&gt; 4 6     5        Final model FALSE             FALSE</span></code></pre></div>
<p>When we filter to only those models, you can see that they are all still up-to-date. Great news.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Devin Pastoor, Seth Green, Anna-Christina Nevison, Sean Wilson, Samuel Callisto, Tim Waterhouse.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
