<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Return a single data frame with model output and input data — nm_join • bbr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Return a single data frame with model output and input data — nm_join"><meta property="og:description" content="For NONMEM models, when a unique row identifier (e.g an integer numbering the
rows) is included in the input data set (i.e. the file in $DATA) and
carried into each table output, nm_join() can read in all output table
files and join back to the input data set. By default, the input data is
joined to the table files so that the number of rows in the result will match
the number of rows in the table files (i.e. the number of rows not bypassed via
$IGNORE). Use the .superset argument to join table outputs to the
(complete) input data set. This function will print the number of rows and
columns when each file is loaded, as well as some information about the
joins. This printing can be suppressed by setting options(bbr.verbose = FALSE)."><meta property="og:image" content="https://metrumresearchgroup.github.io/bbr/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bbr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.11.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/getting-started.html">Getting Started with bbr</a>
    </li>
    <li>
      <a href="../articles/nonmem-parallel.html">Running NONMEM in Parallel: bbr Tips and Tricks</a>
    </li>
    <li>
      <a href="../articles/parameter-labels.html">bbr Parameter Labels</a>
    </li>
    <li>
      <a href="../articles/using-based-on.html">Using the based_on field</a>
    </li>
    <li>
      <a href="../articles/using-summary-log.html">Creating a Model Summary Log</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/metrumresearchgroup/bbr" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Return a single data frame with model output and input data</h1>
    <small class="dont-index">Source: <a href="https://github.com/metrumresearchgroup/bbr/blob/HEAD/R/nm-join.R" class="external-link"><code>R/nm-join.R</code></a></small>
    <div class="hidden name"><code>nm_join.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>For NONMEM models, when a unique row identifier (e.g an integer numbering the
rows) is included in the input data set (i.e. the file in <code>$DATA</code>) and
carried into each table output, <code>nm_join()</code> can read in all output table
files and join back to the input data set. By default, the input data is
joined to the table files so that the number of rows in the result will match
the number of rows in the table files (i.e. the number of rows <em>not</em> bypassed via
<code>$IGNORE</code>). Use the <code>.superset</code> argument to join table outputs to the
(complete) input data set. This function will print the number of rows and
columns when each file is loaded, as well as some information about the
joins. This <strong>printing can be suppressed</strong> by setting <code>options(bbr.verbose = FALSE)</code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">nm_join</span><span class="op">(</span></span>
<span>  <span class="va">.mod</span>,</span>
<span>  .join_col <span class="op">=</span> <span class="st">"NUM"</span>,</span>
<span>  .files <span class="op">=</span> <span class="fu"><a href="nm_tables.html">nm_table_files</a></span><span class="op">(</span><span class="va">.mod</span><span class="op">)</span>,</span>
<span>  .superset <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  .bbi_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>no_grd_file <span class="op">=</span> <span class="cn">TRUE</span>, no_shk_file <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>.mod</dt>
<dd><p>A <code>bbi_nonmem_model</code> or <code>bbi_nonmem_summary</code> object, or a path to
a NONMEM run.</p></dd>


<dt>.join_col</dt>
<dd><p>Character column name to use to join table files. Defaults to
<code>NUM</code>. See Details.</p></dd>


<dt>.files</dt>
<dd><p>Character vector of file paths to table files to read in.
Defaults to calling <code><a href="nm_tables.html">nm_table_files()</a></code> on <code>.mod</code>, which will parse all file
names from <code>$TABLE</code> blocks in the control stream. If passing manually,
paths should be either absolute, or relative to <code>get_output_dir(.mod)</code>.</p></dd>


<dt>.superset</dt>
<dd><p>If <code>FALSE</code>, the default, the data will be joined to the
NONMEM output and if <code>TRUE</code>, the NONMEM output will be joined to the data;
that is, if you use <code>.superset</code>, you will get the same number of rows as
you have in the input data and NONMEM output columns like <code>PRED</code> and
<code>CWRES</code> will be filled with <code>NA</code>.</p></dd>


<dt>.bbi_args</dt>
<dd><p>Named list passed to <code>model_summary(.bbi_args)</code>. See
<code><a href="print_bbi_args.html">print_bbi_args()</a></code> for valid options. Defaults to <code>list(no_grd_file = TRUE, no_shk_file = TRUE)</code> because <code><a href="model_summary.html">model_summary()</a></code> is only called internally to
extract the number of records and individuals, so those files are
irrelevant.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>a tibble</p>
    </div>
    <div id="join-column">
    <h2>Join column</h2>
    


<p>The <code>.join_col</code> is the name of a single column that should appear in both the
input data set and any tables you want to join. We recommend you make this
column a simple integer numbering the rows in the input data set (for example
<code>NUM</code>). When this column is carried into the output table files, there will
be unambiguous matching from the table file back to the input data set.</p>

<ul><li><p>The one exception to this are <code>FIRSTONLY</code> tables. If a table file has the
same number of rows as the there are individuals in the input data set
(accounting for any filtering of data in the NONMEM control stream), it
will assumed to be a <code>FIRSTONLY</code> table. In this case, the table will be
joined to the input data by the <code>ID</code> column. If <code>ID</code> is not present in
the table, it will be using <code>.join_col</code>. Note that if <em>neither</em> <code>ID</code> or
the column passed to <code>.join_col</code> are present in the table, the join will
fail.</p></li>
</ul><p>Note also that, when <code>.join_col</code> is carried into table outputs, <strong>there is no
need to table any other columns from the input data</strong> as long as the
<code>nm_join()</code> approach is used; any column in the input data set, regardless
of whether it is listed in <code>$INPUT</code> or not, will be carried through from the
input data and therefore available in the joined result.</p>
<p><strong>Duplicate Rows Warning for Join Column</strong></p>
<p>If there are duplicate rows found in the specified <code>.join_col</code>, a warning
will be raised specifying a subset of the repeated rows. Duplicates may be
caused by lack of output width. <code>FORMAT</code> may be need to be stated in control
stream to have sufficient width to avoid truncating <code>.join_col</code>.</p>

<div class="section">
<h3 id="example-creating-a-row-number-join-col">Example: creating a row number <code>.join_col</code><a class="anchor" aria-label="anchor" href="#example-creating-a-row-number-join-col"></a></h3>


<p>Take the following <code>$INPUT</code> and <code>$DATA</code> records:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>INPUT ID TIME MDV EVID DV AMT SEX WT ETN</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>DATA ..<span class="sc">/</span>..<span class="sc">/</span>..<span class="sc">/</span>..<span class="sc">/</span>extdata<span class="sc">/</span>acop.csv</span></code></pre><p></p></div>
<p>Before submitting a model, read in the data and add a row number column;</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">nm_data</span>(.mod) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">NUM =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(data, <span class="fu">get_data_path</span>(.mod))</span></code></pre><p></p></div>
<p>Then add <code>'NUM'</code> to the list of input columns:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>INPUT ID TIME MDV EVID DV AMT SEX WT ETN <span class="sc">*</span>NUM<span class="sc">*</span></span></code></pre><p></p></div>
</div>

    </div>
    <div id="details">
    <h2>Details</h2>
    


<p><strong>Duplicate columns are dropped</strong></p>
<p>If a table has columns with the same name as columns in the input data set,
or a table that has already been joined, those columns will be dropped from
the joined data. If <code>getOption(bbr.verbose) == TRUE</code> a message will be
printed about any columns dropped this way.</p>
<p>The one exception to this is the <code>DV</code> column. If <code>DV</code> is present in the input
data <em>and</em> at least one of the table files, the <code>DV</code> column from the input
data will be renamed to <code>DV.DATA</code> and the column from the table file kept as
<code>DV</code>.</p>
<p>The origin of each column is attached to the return value via the
"nm_join_origin" attribute, a list that maps each source (as named by
<code><a href="nm_tables.html">nm_tables()</a></code>) to the columns that came from that source.</p>
<p><strong>Multiple tables per file incompatibility</strong></p>
<p><code>nm_join()</code> is currently <em>not</em> compatible with multiple tables written to a
single files. <strong>To handle multiple tables</strong>, consider reading in the tables via
<code><a href="nm_tables.html">nm_tables()</a></code> (or individually via <code><a href="nm_file.html">nm_file()</a></code> &amp; <code><a href="nm_file_multi_tab.html">nm_file_multi_tab()</a></code>), and
joining the data manually.</p><ul><li><p>Note that <code><a href="nm_join_sim.html">nm_join_sim()</a></code> <em>does</em> support multiple tables for simulations.</p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="nm_join_sim.html">nm_join_sim()</a></code>, <code><a href="nm_tables.html">nm_tables()</a></code>, <code><a href="nm_tables.html">nm_table_files()</a></code>, <code><a href="nm_file.html">nm_file()</a></code>,
<code><a href="nm_file_multi_tab.html">nm_file_multi_tab()</a></code></p></div>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Seth Green, Kyle Barrett, Ryan Marinelli, Kyle Meyer, Devin Pastoor, Anna-Christina Nevison, Sean Wilson, Samuel Callisto, Tim Waterhouse, Kyle T Baron.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

